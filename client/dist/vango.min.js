var Vango=(()=>{var N=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var q=(a,e)=>{for(var t in e)N(a,t,{get:e[t],enumerable:!0})},W=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X(e))!G.call(a,n)&&n!==t&&N(a,n,{get:()=>e[n],enumerable:!(s=Y(e,n))||s.enumerable});return a};var z=a=>W(N({},"__esModule",{value:!0}),a);var j={};q(j,{EventType:()=>r,VangoClient:()=>_,default:()=>$});function v(a){let e=0;for(let n=0;n<a.length;n++)e+=a[n].length;let t=new Uint8Array(e),s=0;for(let n=0;n<a.length;n++)t.set(a[n],s),s+=a[n].length;return t}var r={CLICK:1,DBLCLICK:2,MOUSEDOWN:3,MOUSEUP:4,MOUSEMOVE:5,MOUSEENTER:6,MOUSELEAVE:7,INPUT:16,CHANGE:17,SUBMIT:18,FOCUS:19,BLUR:20,KEYDOWN:32,KEYUP:33,KEYPRESS:34,SCROLL:48,RESIZE:49,TOUCHSTART:64,TOUCHMOVE:65,TOUCHEND:66,DRAGSTART:80,DRAGEND:81,DROP:82,HOOK:96,NAVIGATE:112,CUSTOM:255},c={SET_TEXT:1,SET_ATTR:2,REMOVE_ATTR:3,INSERT_NODE:4,REMOVE_NODE:5,MOVE_NODE:6,REPLACE_NODE:7,SET_VALUE:8,SET_CHECKED:9,SET_SELECTED:10,FOCUS:11,BLUR:12,SCROLL_TO:13,ADD_CLASS:16,REMOVE_CLASS:17,TOGGLE_CLASS:18,SET_STYLE:19,REMOVE_STYLE:20,SET_DATA:21,DISPATCH:32},p={CTRL:1,SHIFT:2,ALT:4,META:8},F={ELEMENT:1,TEXT:2,FRAGMENT:3},g={NULL:0,BOOL:1,INT:2,FLOAT:3,STRING:4,ARRAY:5,OBJECT:6},y=class{constructor(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}encodeEvent(e,t,s,n=null){let i=[];switch(i.push(this.encodeUvarint(e)),i.push(new Uint8Array([t])),i.push(this.encodeString(s)),t){case r.INPUT:case r.CHANGE:i.push(this.encodeString((n==null?void 0:n.value)||""));break;case r.SUBMIT:this.encodeFormData(i,n);break;case r.KEYDOWN:case r.KEYUP:case r.KEYPRESS:this.encodeKeyboardEvent(i,n);break;case r.MOUSEDOWN:case r.MOUSEUP:case r.MOUSEMOVE:this.encodeMouseEvent(i,n);break;case r.SCROLL:this.encodeScrollEvent(i,n);break;case r.RESIZE:this.encodeResizeEvent(i,n);break;case r.TOUCHSTART:case r.TOUCHMOVE:case r.TOUCHEND:this.encodeTouchEvent(i,n);break;case r.DRAGSTART:case r.DRAGEND:case r.DROP:this.encodeDragEvent(i,n);break;case r.HOOK:this.encodeHookEvent(i,n);break;case r.NAVIGATE:i.push(this.encodeString((n==null?void 0:n.path)||"")),i.push(new Uint8Array([n!=null&&n.replace?1:0]));break;case r.CUSTOM:i.push(this.encodeString((n==null?void 0:n.name)||"")),i.push(this.encodeLenBytes((n==null?void 0:n.data)||new Uint8Array(0)));break;case r.CLICK:case r.DBLCLICK:case r.FOCUS:case r.BLUR:case r.MOUSEENTER:case r.MOUSELEAVE:default:break}return v(i)}decodePatches(e){let t=0,{value:s,bytesRead:n}=this.decodeUvarint(e,t);t+=n;let{value:i,bytesRead:l}=this.decodeUvarint(e,t);t+=l;let h=[];for(let o=0;o<i;o++){let{patch:d,bytesRead:u}=this.decodePatch(e,t);h.push(d),t+=u}return{seq:s,patches:h}}decodePatch(e,t){let s=t,n={};n.type=e[t++];let{value:i,bytesRead:l}=this.decodeString(e,t);switch(n.hid=i,t+=l,n.type){case c.SET_TEXT:case c.SET_VALUE:{let{value:h,bytesRead:o}=this.decodeString(e,t);n.value=h,t+=o;break}case c.SET_ATTR:case c.SET_STYLE:case c.SET_DATA:{let{value:h,bytesRead:o}=this.decodeString(e,t);t+=o;let{value:d,bytesRead:u}=this.decodeString(e,t);t+=u,n.key=h,n.value=d;break}case c.REMOVE_ATTR:case c.REMOVE_STYLE:{let{value:h,bytesRead:o}=this.decodeString(e,t);n.key=h,t+=o;break}case c.ADD_CLASS:case c.REMOVE_CLASS:case c.TOGGLE_CLASS:{let{value:h,bytesRead:o}=this.decodeString(e,t);n.className=h,t+=o;break}case c.INSERT_NODE:{let{value:h,bytesRead:o}=this.decodeString(e,t);t+=o;let{value:d,bytesRead:u}=this.decodeUvarint(e,t);t+=u;let{vnode:m,bytesRead:R}=this.decodeVNode(e,t);t+=R,n.parentID=h,n.index=d,n.vnode=m;break}case c.REMOVE_NODE:break;case c.MOVE_NODE:{let{value:h,bytesRead:o}=this.decodeString(e,t);t+=o;let{value:d,bytesRead:u}=this.decodeUvarint(e,t);t+=u,n.parentID=h,n.index=d;break}case c.REPLACE_NODE:{let{vnode:h,bytesRead:o}=this.decodeVNode(e,t);t+=o,n.vnode=h;break}case c.SET_CHECKED:case c.SET_SELECTED:{n.value=e[t++]===1;break}case c.FOCUS:case c.BLUR:break;case c.SCROLL_TO:{let{value:h,bytesRead:o}=this.decodeSvarint(e,t);t+=o;let{value:d,bytesRead:u}=this.decodeSvarint(e,t);t+=u,n.x=h,n.y=d,n.behavior=e[t++];break}case c.DISPATCH:{let{value:h,bytesRead:o}=this.decodeString(e,t);t+=o;let{value:d,bytesRead:u}=this.decodeString(e,t);t+=u,n.eventName=h,n.detail=d;break}default:break}return{patch:n,bytesRead:t-s}}decodeVNode(e,t){let s=t,n={};switch(e[t++]){case F.ELEMENT:{n.type="element";let{value:l,bytesRead:h}=this.decodeString(e,t);n.tag=l,t+=h;let{value:o,bytesRead:d}=this.decodeString(e,t);n.hid=o||null,t+=d;let{value:u,bytesRead:m}=this.decodeUvarint(e,t);t+=m,n.attrs={};for(let E=0;E<u;E++){let{value:U,bytesRead:D}=this.decodeString(e,t);t+=D;let{value:K,bytesRead:P}=this.decodeString(e,t);t+=P,n.attrs[U]=K}let{value:R,bytesRead:B}=this.decodeUvarint(e,t);t+=B,n.children=[];for(let E=0;E<R;E++){let{vnode:U,bytesRead:D}=this.decodeVNode(e,t);n.children.push(U),t+=D}break}case F.TEXT:{n.type="text";let{value:l,bytesRead:h}=this.decodeString(e,t);n.text=l,t+=h;break}case F.FRAGMENT:{n.type="fragment";let{value:l,bytesRead:h}=this.decodeUvarint(e,t);t+=h,n.children=[];for(let o=0;o<l;o++){let{vnode:d,bytesRead:u}=this.decodeVNode(e,t);n.children.push(d),t+=u}break}default:n.type="unknown"}return{vnode:n,bytesRead:t-s}}encodeString(e){let t=this.textEncoder.encode(e),s=this.encodeUvarint(t.length);return v([s,t])}decodeString(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t),i=e.slice(t+n,t+n+s);return{value:this.textDecoder.decode(i),bytesRead:n+s}}encodeUvarint(e){let t=[];for(;e>127;)t.push(e&127|128),e>>>=7;return t.push(e&127),new Uint8Array(t)}decodeUvarint(e,t){let s=0,n=0,i=0;for(;;){let l=e[t+i];if(i++,s|=(l&127)<<n,!(l&128))break;n+=7}return{value:s,bytesRead:i}}encodeSvarint(e){let t=e<<1^e>>31;return this.encodeUvarint(t>>>0)}decodeSvarint(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t);return{value:s>>>1^-(s&1),bytesRead:n}}encodeLenBytes(e){let t=this.encodeUvarint(e.length);return v([t,e])}decodeLenBytes(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t);return{value:e.slice(t+n,t+n+s),bytesRead:n+s}}encodeFormData(e,t){if(!t){e.push(this.encodeUvarint(0));return}let s=[];if(t instanceof FormData)for(let[n,i]of t.entries())s.push({key:n,value:String(i)});else if(typeof t=="object")for(let[n,i]of Object.entries(t))s.push({key:n,value:String(i)});e.push(this.encodeUvarint(s.length));for(let{key:n,value:i}of s)e.push(this.encodeString(n)),e.push(this.encodeString(i))}encodeKeyboardEvent(e,t){e.push(this.encodeString((t==null?void 0:t.key)||""));let s=0;t!=null&&t.ctrlKey&&(s|=p.CTRL),t!=null&&t.shiftKey&&(s|=p.SHIFT),t!=null&&t.altKey&&(s|=p.ALT),t!=null&&t.metaKey&&(s|=p.META),e.push(new Uint8Array([s]))}encodeMouseEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.clientX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.clientY)||0)),e.push(new Uint8Array([(t==null?void 0:t.button)||0]));let s=0;t!=null&&t.ctrlKey&&(s|=p.CTRL),t!=null&&t.shiftKey&&(s|=p.SHIFT),t!=null&&t.altKey&&(s|=p.ALT),t!=null&&t.metaKey&&(s|=p.META),e.push(new Uint8Array([s]))}encodeScrollEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.scrollTop)||0)),e.push(this.encodeSvarint((t==null?void 0:t.scrollLeft)||0))}encodeResizeEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.width)||0)),e.push(this.encodeSvarint((t==null?void 0:t.height)||0))}encodeTouchEvent(e,t){let s=(t==null?void 0:t.touches)||[];e.push(this.encodeUvarint(s.length));for(let n of s)e.push(this.encodeSvarint(n.id||0)),e.push(this.encodeSvarint(n.clientX||0)),e.push(this.encodeSvarint(n.clientY||0))}encodeDragEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.clientX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.clientY)||0));let s=0;t!=null&&t.ctrlKey&&(s|=p.CTRL),t!=null&&t.shiftKey&&(s|=p.SHIFT),t!=null&&t.altKey&&(s|=p.ALT),t!=null&&t.metaKey&&(s|=p.META),e.push(new Uint8Array([s]))}encodeHookEvent(e,t){e.push(this.encodeString((t==null?void 0:t.name)||"")),this.encodeHookData(e,(t==null?void 0:t.data)||{})}encodeHookData(e,t){let s=Object.entries(t);e.push(this.encodeUvarint(s.length));for(let[n,i]of s)e.push(this.encodeString(n)),this.encodeHookValue(e,i)}encodeHookValue(e,t){if(t==null)e.push(new Uint8Array([g.NULL]));else if(typeof t=="boolean")e.push(new Uint8Array([g.BOOL,t?1:0]));else if(typeof t=="number"&&Number.isInteger(t))e.push(new Uint8Array([g.INT])),e.push(this.encodeSvarint(t));else if(typeof t=="number")e.push(new Uint8Array([g.FLOAT])),e.push(this.encodeFloat64(t));else if(typeof t=="string")e.push(new Uint8Array([g.STRING])),e.push(this.encodeString(t));else if(Array.isArray(t)){e.push(new Uint8Array([g.ARRAY])),e.push(this.encodeUvarint(t.length));for(let s of t)this.encodeHookValue(e,s)}else if(typeof t=="object"){e.push(new Uint8Array([g.OBJECT]));let s=Object.entries(t);e.push(this.encodeUvarint(s.length));for(let[n,i]of s)e.push(this.encodeString(n)),this.encodeHookValue(e,i)}else e.push(new Uint8Array([g.NULL]))}encodeFloat64(e){let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),new Uint8Array(t)}encodeClientHello(e={}){let t=[];t.push(new Uint8Array([2,0])),t.push(this.encodeString(e.csrf||"")),t.push(this.encodeString(e.sessionId||"")),t.push(this.encodeUint32(e.lastSeq||0)),t.push(this.encodeUint16(e.viewportW||window.innerWidth)),t.push(this.encodeUint16(e.viewportH||window.innerHeight));let s=new Date().getTimezoneOffset();return t.push(this.encodeInt16(-s)),v(t)}decodeServerHello(e){if(e.length<2)return{error:"Buffer too short"};let t=e[0];if(t!==0)return{error:`Unexpected frame type: ${t}`};let s=1,n=e[s++],{value:i,bytesRead:l}=this.decodeString(e,s);s+=l;let h=this.decodeUint32(e,s);s+=4;let o=this.decodeUint64(e,s);s+=8;let d=this.decodeUint16(e,s);return{status:n,sessionId:i,nextSeq:h,serverTime:o,flags:d,ok:n===0}}encodeUint16(e){return new Uint8Array([e&255,e>>8&255])}decodeUint16(e,t){return e[t]|e[t+1]<<8}encodeInt16(e){return this.encodeUint16(e&65535)}encodeUint32(e){return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}decodeUint32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}decodeUint64(e,t){let s=this.decodeUint32(e,t),n=this.decodeUint32(e,t+4);return s+n*4294967296}};var b=class{constructor(e,t={}){this.client=e,this.options={reconnect:t.reconnect!==!1,reconnectInterval:t.reconnectInterval||1e3,reconnectMaxInterval:t.reconnectMaxInterval||3e4,heartbeatInterval:t.heartbeatInterval||3e4,...t},this.ws=null,this.connected=!1,this.handshakeComplete=!1,this.sessionId=null,this.reconnectAttempts=0,this.heartbeatTimer=null,this.messageQueue=[]}connect(e){this.ws&&this.ws.close(),this.url=e,this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>this._onOpen(),this.ws.onclose=t=>this._onClose(t),this.ws.onerror=t=>this._onError(t),this.ws.onmessage=t=>this._onMessage(t)}_onOpen(){this.client.options.debug&&console.log("[Vango] WebSocket connected"),this.reconnectAttempts=0,this._sendHandshake(),this._startHeartbeat()}_sendHandshake(){let e=this.client.codec.encodeClientHello({csrf:this._getCSRFToken(),sessionId:this.sessionId||"",viewportW:window.innerWidth,viewportH:window.innerHeight});this.ws.send(e),this.client.options.debug&&console.log("[Vango] Sent binary ClientHello")}_getCSRFToken(){if(window.__VANGO_CSRF__)return window.__VANGO_CSRF__;let e=document.cookie.match(/(?:^|;\s*)__vango_csrf=([^;]*)/);return e?decodeURIComponent(e[1]):""}_onMessage(e){if(!(e.data instanceof ArrayBuffer)){this.client.options.debug&&console.warn("[Vango] Received non-binary message:",e.data);return}let t=new Uint8Array(e.data);if(!this.handshakeComplete){let s=this.client.codec.decodeServerHello(t);if(s.error){this.client.options.debug&&console.error("[Vango] Handshake error:",s.error),this.client._onError(new Error(s.error));return}if(!s.ok){let i={1:"Version mismatch",2:"Invalid CSRF token",3:"Session expired",4:"Server busy",5:"Upgrade required",6:"Invalid format",7:"Not authorized",8:"Internal error"}[s.status]||`Handshake failed: ${s.status}`;this.client._onError(new Error(i)),this.ws.close();return}this.handshakeComplete=!0,this.connected=!0,this.sessionId=s.sessionId,this.client._onConnected(),this._flushQueue(),this.client.options.debug&&console.log("[Vango] Handshake complete, session:",this.sessionId);return}this.client._handleBinaryMessage(t)}_onClose(e){let t=this.connected;this.connected=!1,this.handshakeComplete=!1,this._stopHeartbeat(),this.client.options.debug&&console.log("[Vango] WebSocket closed:",e.code,e.reason),t&&this.client._onDisconnected(),this.options.reconnect&&!e.wasClean&&this._scheduleReconnect()}_onError(e){this.client.options.debug&&console.error("[Vango] WebSocket error:",e),this.client._onError(new Error("WebSocket error"))}_scheduleReconnect(){let e=Math.min(this.options.reconnectInterval*Math.pow(2,this.reconnectAttempts),this.options.reconnectMaxInterval);this.reconnectAttempts++,this.client.options.debug&&console.log(`[Vango] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>this.connect(this.url),e)}_startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.connected&&this._sendPing()},this.options.heartbeatInterval)}_stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}_sendPing(){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let e=Date.now(),t=new Uint8Array(9);t[0]=1;let s=e;for(let i=0;i<8;i++)t[1+i]=s&255,s=Math.floor(s/256);let n=new Uint8Array(4+t.length);n[0]=3,n[1]=0,n[2]=t.length>>8&255,n[3]=t.length&255,n.set(t,4),this.ws.send(n)}}send(e){return this.connected&&this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(e),!0):(this.messageQueue.push(e),!1)}_flushQueue(){for(;this.messageQueue.length>0&&this.connected;){let e=this.messageQueue.shift();this.ws.send(e)}}close(){this.options.reconnect=!1,this._stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client closing"),this.ws=null)}};var f=class{constructor(e){this.client=e,this.handlers=new Map,this.debounceTimers=new Map,this.scrollThrottled=new Set}attach(){this._on("click",this._handleClick.bind(this)),this._on("dblclick",this._handleDblClick.bind(this)),this._on("input",this._handleInput.bind(this)),this._on("change",this._handleChange.bind(this)),this._on("submit",this._handleSubmit.bind(this)),this._on("focus",this._handleFocus.bind(this),!0),this._on("blur",this._handleBlur.bind(this),!0),this._on("keydown",this._handleKeyDown.bind(this)),this._on("keyup",this._handleKeyUp.bind(this)),this._on("mouseenter",this._handleMouseEnter.bind(this),!0),this._on("mouseleave",this._handleMouseLeave.bind(this),!0),this._on("scroll",this._handleScroll.bind(this),!0),this._on("click",this._handleLinkClick.bind(this)),window.addEventListener("popstate",this._handlePopState.bind(this))}detach(){for(let[e,{handler:t,capture:s}]of this.handlers)document.removeEventListener(e,t,s);this.handlers.clear();for(let e of this.debounceTimers.values())clearTimeout(e);this.debounceTimers.clear()}_on(e,t,s=!1){document.addEventListener(e,t,{capture:s,passive:!1}),this.handlers.set(`${e}-${s}`,{handler:t,capture:s})}_findHidElement(e){return!e||!e.closest?null:e.closest("[data-hid]")}_findHidElementWithHandler(e,t){if(!e||!e.closest)return null;let s=e.closest("[data-hid]");for(;s;){if(s.hasAttribute(t))return s;let n=s.parentElement;if(!n)break;s=n.closest("[data-hid]")}return null}_handleClick(e){let t=this._findHidElementWithHandler(e.target,"data-on-click");t&&(e.preventDefault(),this.client.optimistic.applyOptimistic(t,"click"),this.client.sendEvent(r.CLICK,t.dataset.hid))}_handleDblClick(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-dblclick")||(e.preventDefault(),this.client.sendEvent(r.DBLCLICK,t.dataset.hid))}_handleInput(e){let t=this._findHidElement(e.target);if(!t||!t.hasAttribute("data-on-input"))return;let s=t.dataset.hid,n=parseInt(t.dataset.debounce||"100",10);this.debounceTimers.has(s)&&clearTimeout(this.debounceTimers.get(s));let i=setTimeout(()=>{this.debounceTimers.delete(s),this.client.sendEvent(r.INPUT,s,{value:t.value})},n);this.debounceTimers.set(s,i)}_handleChange(e){let t=this._findHidElement(e.target);if(!t||!t.hasAttribute("data-on-change"))return;let s;t.type==="checkbox"?s=t.checked?"true":"false":t.type==="radio"?s=t.checked?t.value:"":t.tagName==="SELECT"&&t.multiple?s=Array.from(t.selectedOptions).map(n=>n.value).join(","):s=t.value,this.client.optimistic.applyOptimistic(t,"change"),this.client.sendEvent(r.CHANGE,t.dataset.hid,{value:s})}_handleSubmit(e){let t=e.target.closest("form[data-hid]");if(!t||!t.hasAttribute("data-on-submit"))return;e.preventDefault();let s=new FormData(t),n={};for(let[i,l]of s.entries())n[i]=String(l);this.client.sendEvent(r.SUBMIT,t.dataset.hid,n)}_handleFocus(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-focus")||this.client.sendEvent(r.FOCUS,t.dataset.hid)}_handleBlur(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-blur")||this.client.sendEvent(r.BLUR,t.dataset.hid)}_handleKeyDown(e){let t=this._findHidElement(e.target);if(!t||!t.hasAttribute("data-on-keydown"))return;let s=t.dataset.keyFilter;if(s&&!this._matchesKeyFilter(e,s))return;t.dataset.preventDefault!=="false"&&e.preventDefault(),this.client.sendEvent(r.KEYDOWN,t.dataset.hid,{key:e.key,code:e.code,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey})}_handleKeyUp(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-keyup")||this.client.sendEvent(r.KEYUP,t.dataset.hid,{key:e.key,code:e.code,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey})}_handleMouseEnter(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-mouseenter")||this.client.sendEvent(r.MOUSEENTER,t.dataset.hid)}_handleMouseLeave(e){let t=this._findHidElement(e.target);!t||!t.hasAttribute("data-on-mouseleave")||this.client.sendEvent(r.MOUSELEAVE,t.dataset.hid)}_handleScroll(e){let t=this._findHidElement(e.target);if(!t||!t.hasAttribute("data-on-scroll"))return;let s=t.dataset.hid,n=parseInt(t.dataset.throttle||"100",10);this.scrollThrottled.has(s)||(this.scrollThrottled.add(s),setTimeout(()=>{this.scrollThrottled.delete(s)},n),this.client.sendEvent(r.SCROLL,s,{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}))}_handleLinkClick(e){let t=e.target.closest("a[href]");if(!t)return;let s=t.getAttribute("href");!s||s.startsWith("http")||s.startsWith("//")||t.hasAttribute("data-external")||t.target==="_blank"||(e.preventDefault(),history.pushState(null,"",s),this.client.sendEvent(r.NAVIGATE,"nav",{path:s}))}_handlePopState(e){this.client.sendEvent(r.NAVIGATE,"nav",{path:location.pathname})}_matchesKeyFilter(e,t){let s=t.split("+"),n=s.pop().toLowerCase(),i=new Set(s.map(u=>u.toLowerCase()));if(e.key.toLowerCase()!==n)return!1;let l=i.has("ctrl")||i.has("control"),h=i.has("shift"),o=i.has("alt"),d=i.has("meta")||i.has("cmd");return!(l!==e.ctrlKey||h!==e.shiftKey||o!==e.altKey||d!==e.metaKey)}};var T=class{constructor(e){this.client=e}apply(e){for(let t of e)this.applyPatch(t)}applyPatch(e){let t=this.client.getNode(e.hid);if(!t&&e.type!==c.INSERT_NODE){this.client.options.debug&&console.warn("[Vango] Node not found:",e.hid);return}switch(e.type){case c.SET_TEXT:this._setText(t,e.value);break;case c.SET_ATTR:this._setAttr(t,e.key,e.value);break;case c.REMOVE_ATTR:this._removeAttr(t,e.key);break;case c.ADD_CLASS:t.classList.add(e.className);break;case c.REMOVE_CLASS:t.classList.remove(e.className);break;case c.TOGGLE_CLASS:t.classList.toggle(e.className);break;case c.SET_STYLE:t.style[e.key]=e.value;break;case c.REMOVE_STYLE:t.style[e.key]="";break;case c.INSERT_NODE:this._insertNode(e.parentID,e.index,e.vnode);break;case c.REMOVE_NODE:this._removeNode(t,e.hid);break;case c.MOVE_NODE:this._moveNode(t,e.parentID,e.index);break;case c.REPLACE_NODE:this._replaceNode(t,e.hid,e.vnode);break;case c.SET_VALUE:this._setValue(t,e.value);break;case c.SET_CHECKED:t.checked=e.value;break;case c.SET_SELECTED:t.selected=e.value;break;case c.FOCUS:t.focus();break;case c.BLUR:t.blur();break;case c.SCROLL_TO:t.scrollTo({left:e.x,top:e.y,behavior:e.behavior===1?"smooth":"instant"});break;case c.SET_DATA:t.dataset[e.key]=e.value;break;case c.DISPATCH:this._dispatchEvent(t,e.eventName,e.detail);break;default:this.client.options.debug&&console.warn("[Vango] Unknown patch type:",e.type)}}_setText(e,t){e.textContent=t}_setAttr(e,t,s){if(t.length>2&&t.substring(0,2).toLowerCase()==="on"){console.warn("[Vango] Blocked dangerous attribute:",t);return}switch(t){case"class":e.className=s;break;case"for":e.htmlFor=s;break;case"value":this._setValue(e,s);break;case"checked":e.checked=s==="true"||s==="";break;case"selected":e.selected=s==="true"||s==="";break;case"disabled":case"readonly":case"required":case"multiple":case"autofocus":s==="true"||s===""?e.setAttribute(t,""):e.removeAttribute(t);break;default:e.setAttribute(t,s)}}_removeAttr(e,t){switch(t){case"class":e.className="";break;case"for":e.htmlFor="";break;case"value":e.value="";break;case"checked":e.checked=!1;break;case"selected":e.selected=!1;break;default:e.removeAttribute(t)}}_setValue(e,t){if(e.value!==t)if(e.type==="text"||e.tagName==="TEXTAREA"){let s=e.selectionStart,n=e.selectionEnd;e.value=t,document.activeElement===e&&e.setSelectionRange(Math.min(s,t.length),Math.min(n,t.length))}else e.value=t}_insertNode(e,t,s){let n=this.client.getNode(e);if(!n){this.client.options.debug&&console.warn("[Vango] Parent node not found:",e);return}let i=this._createNode(s);t>=n.children.length?n.appendChild(i):n.insertBefore(i,n.children[t])}_removeNode(e,t){this.client.hooks.destroyForNode(e),this.client.unregisterNode(t),e.querySelectorAll("[data-hid]").forEach(s=>{this.client.hooks.destroyForNode(s),this.client.unregisterNode(s.dataset.hid)}),e.remove()}_moveNode(e,t,s){let n=this.client.getNode(t);if(!n){this.client.options.debug&&console.warn("[Vango] Parent node not found:",t);return}s>=n.children.length?n.appendChild(e):n.insertBefore(e,n.children[s])}_replaceNode(e,t,s){this.client.hooks.destroyForNode(e),this.client.unregisterNode(t),e.querySelectorAll("[data-hid]").forEach(i=>{this.client.hooks.destroyForNode(i),this.client.unregisterNode(i.dataset.hid)});let n=this._createNode(s);e.replaceWith(n)}_createNode(e){switch(e.type){case"element":return this._createElement(e);case"text":return document.createTextNode(e.text);case"fragment":return this._createFragment(e);default:return this.client.options.debug&&console.warn("[Vango] Unknown vnode type:",e.type),document.createTextNode("")}}_createElement(e){let t=document.createElement(e.tag);for(let[s,n]of Object.entries(e.attrs||{}))this._setAttr(t,s,n);e.hid&&(t.dataset.hid=e.hid,this.client.registerNode(e.hid,t));for(let s of e.children||[])t.appendChild(this._createNode(s));return this.client.hooks.initializeForNode(t),t}_createFragment(e){let t=document.createDocumentFragment();for(let s of e.children||[])t.appendChild(this._createNode(s));return t}_dispatchEvent(e,t,s){let n=null;if(s)try{n=JSON.parse(s)}catch(l){n=s}let i=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});e.dispatchEvent(i)}};var x=class{constructor(e){this.client=e,this.pending=new Map}applyOptimistic(e,t){let s=e.dataset.hid;if(!s)return;let n=e.dataset.optimisticClass;n&&this._applyClassOptimistic(e,s,n);let i=e.dataset.optimisticText;i&&this._applyTextOptimistic(e,s,i);let l=e.dataset.optimisticAttr,h=e.dataset.optimisticValue;l&&h!==void 0&&this._applyAttrOptimistic(e,s,l,h);let o=e.dataset.optimisticParentClass;if(o&&e.parentElement){let d=e.parentElement.dataset.hid||`parent-${s}`;this._applyClassOptimistic(e.parentElement,d,o)}}_applyClassOptimistic(e,t,s){let[n,i="toggle"]=s.split(":"),l=e.classList.contains(n);switch(i){case"add":e.classList.add(n);break;case"remove":e.classList.remove(n);break;case"toggle":default:e.classList.toggle(n)}this._trackPending(t,"class",n,l)}_applyTextOptimistic(e,t,s){let n=e.textContent;e.textContent=s,this._trackPending(t,"text",null,n)}_applyAttrOptimistic(e,t,s,n){if(s.length>2&&s.substring(0,2).toLowerCase()==="on"){console.warn("[Vango] Blocked dangerous optimistic attribute:",s);return}let i=e.getAttribute(s);n==="null"||n===""?e.removeAttribute(s):e.setAttribute(s,n),this._trackPending(t,"attr",s,i)}_trackPending(e,t,s,n){this.pending.has(e)||this.pending.set(e,[]),this.pending.get(e).push({type:t,key:s,original:n})}clearPending(){this.pending.clear()}revertAll(){for(let[e,t]of this.pending){let s=this.client.getNode(e);if(s)for(let n of t)this._revertUpdate(s,n)}this.pending.clear()}_revertUpdate(e,t){switch(t.type){case"class":t.original?e.classList.add(t.key):e.classList.remove(t.key);break;case"text":e.textContent=t.original;break;case"attr":t.original===null?e.removeAttribute(t.key):e.setAttribute(t.key,t.original);break}}};var S=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.animation=t.animation||150,this.handle=t.handle||null,this.ghostClass=t.ghostClass||"sortable-ghost",this.dragClass=t.dragClass||"sortable-drag",this.dragging=null,this.ghost=null,this.startIndex=-1,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(e){this._unbindEvents()}_bindEvents(){this._onMouseDown=this._handleMouseDown.bind(this),this._onMouseMove=this._handleMouseMove.bind(this),this._onMouseUp=this._handleMouseUp.bind(this),this.el.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._onTouchStart=this._handleTouchStart.bind(this),this._onTouchMove=this._handleTouchMove.bind(this),this._onTouchEnd=this._handleTouchEnd.bind(this),this.el.addEventListener("touchstart",this._onTouchStart,{passive:!1}),document.addEventListener("touchmove",this._onTouchMove,{passive:!1}),document.addEventListener("touchend",this._onTouchEnd)}_unbindEvents(){this.el.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this.el.removeEventListener("touchstart",this._onTouchStart),document.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("touchend",this._onTouchEnd)}_handleMouseDown(e){let t=this._findItem(e.target);t&&(this.handle&&!e.target.closest(this.handle)||(e.preventDefault(),this._startDrag(t,e.clientX,e.clientY)))}_handleTouchStart(e){let t=this._findItem(e.target);if(!t||this.handle&&!e.target.closest(this.handle))return;e.preventDefault();let s=e.touches[0];this._startDrag(t,s.clientX,s.clientY)}_findItem(e){let t=e;for(;t&&t.parentElement!==this.el;)t=t.parentElement;return t}_startDrag(e,t,s){this.dragging=e,this.activeContainer=e.parentElement,this.initialContainer=this.activeContainer,this.startIndex=Array.from(this.activeContainer.children).indexOf(e),this.startY=s,this.startX=t,this.itemHeight=e.offsetHeight;let n=e.getBoundingClientRect();this.ghostStartTop=n.top,this.ghostStartLeft=n.left,this.ghost=e.cloneNode(!0),this.ghost.classList.add(this.ghostClass),this.ghost.style.position="fixed",this.ghost.style.zIndex="9999",this.ghost.style.width=`${e.offsetWidth}px`,this.ghost.style.height=`${e.offsetHeight}px`,this.ghost.style.left=`${this.ghostStartLeft}px`,this.ghost.style.top=`${this.ghostStartTop}px`,this.ghost.style.pointerEvents="none",this.ghost.style.opacity="0.8",this.ghost.style.transition="none",document.body.appendChild(this.ghost),e.classList.add(this.dragClass),e.style.opacity="0.4"}_handleMouseMove(e){this.dragging&&(e.preventDefault(),this._updateDrag(e.clientX,e.clientY))}_handleTouchMove(e){if(!this.dragging)return;e.preventDefault();let t=e.touches[0];this._updateDrag(t.clientX,t.clientY)}_updateDrag(e,t){let s=t-this.startY,n=e-this.startX;this.ghost&&(this.ghost.style.top=`${this.ghostStartTop+s}px`,this.ghost.style.left=`${this.ghostStartLeft+n}px`),this.ghost.style.display="none";let i=document.elementFromPoint(e,t);if(this.ghost.style.display="",i){let o=i.closest('[data-hook="Sortable"]');if(o&&o!==this.activeContainer&&o.dataset.hookConfig)try{JSON.parse(o.dataset.hookConfig).group===this.config.group&&(this.activeContainer=o,this.activeContainer.appendChild(this.dragging))}catch(d){}}let l=Array.from(this.activeContainer.children),h=l.indexOf(this.dragging);for(let o=0;o<l.length;o++){if(o===h)continue;let d=l[o],u=d.getBoundingClientRect(),m=u.top+u.height/2;if(t<m&&o<h){this.activeContainer.insertBefore(this.dragging,d);break}else if(t>m&&o>h){this.activeContainer.insertBefore(this.dragging,d.nextSibling);break}}}_handleMouseUp(e){this.dragging&&this._endDrag()}_handleTouchEnd(e){this.dragging&&this._endDrag()}_endDrag(){let e=Array.from(this.activeContainer.children).indexOf(this.dragging),t=this.dragging.dataset.id||this.dragging.dataset.hid,s=this.activeContainer.dataset.hid;this.dragging.classList.remove(this.dragClass),this.dragging.style.opacity="",this.ghost&&this.ghost.remove(),(this.activeContainer!==this.initialContainer||e!==this.startIndex)&&this.pushEvent("reorder",{id:t,fromContainer:this.initialContainer.dataset.id||this.initialContainer.dataset.hid,toContainer:this.activeContainer.dataset.id||this.activeContainer.dataset.hid,fromIndex:this.startIndex,toIndex:e}),this.dragging=null,this.ghost=null,this.activeContainer=null,this.initialContainer=null}};var k=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.axis=t.axis||"both",this.handle=t.handle||null,this.bounds=t.bounds||null,this.dragging=!1,this.startX=0,this.startY=0,this.currentX=0,this.currentY=0,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s,this.axis=t.axis||"both",this.bounds=t.bounds||null}destroyed(e){this._unbindEvents()}_bindEvents(){this._onMouseDown=this._handleMouseDown.bind(this),this._onMouseMove=this._handleMouseMove.bind(this),this._onMouseUp=this._handleMouseUp.bind(this);let e=this.handle?this.el.querySelector(this.handle):this.el;e&&e.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._onTouchStart=this._handleTouchStart.bind(this),this._onTouchMove=this._handleTouchMove.bind(this),this._onTouchEnd=this._handleTouchEnd.bind(this),e&&e.addEventListener("touchstart",this._onTouchStart,{passive:!1}),document.addEventListener("touchmove",this._onTouchMove,{passive:!1}),document.addEventListener("touchend",this._onTouchEnd)}_unbindEvents(){let e=this.handle?this.el.querySelector(this.handle):this.el;e&&(e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("touchstart",this._onTouchStart)),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("touchend",this._onTouchEnd)}_handleMouseDown(e){e.preventDefault(),this._startDrag(e.clientX,e.clientY)}_handleTouchStart(e){e.preventDefault();let t=e.touches[0];this._startDrag(t.clientX,t.clientY)}_startDrag(e,t){this.dragging=!0,this.startX=e-this.currentX,this.startY=t-this.currentY,this.el.classList.add("dragging")}_handleMouseMove(e){this.dragging&&(e.preventDefault(),this._updatePosition(e.clientX,e.clientY))}_handleTouchMove(e){if(!this.dragging)return;e.preventDefault();let t=e.touches[0];this._updatePosition(t.clientX,t.clientY)}_updatePosition(e,t){let s=e-this.startX,n=t-this.startY;if(this.axis==="x"?n=this.currentY:this.axis==="y"&&(s=this.currentX),this.bounds){let i=this._getBounds();s=Math.max(i.minX,Math.min(i.maxX,s)),n=Math.max(i.minY,Math.min(i.maxY,n))}this.currentX=s,this.currentY=n,this.el.style.transform=`translate(${s}px, ${n}px)`}_getBounds(){let e=this.el.getBoundingClientRect(),t;return this.bounds==="parent"?t=this.el.parentElement.getBoundingClientRect():t={left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},{minX:t.left-e.left+this.currentX,maxX:t.right-e.right+this.currentX,minY:t.top-e.top+this.currentY,maxY:t.bottom-e.bottom+this.currentY}}_handleMouseUp(e){this.dragging&&this._endDrag()}_handleTouchEnd(e){this.dragging&&this._endDrag()}_endDrag(){this.dragging=!1,this.el.classList.remove("dragging"),this.pushEvent("position",{x:this.currentX,y:this.currentY})}};var w=class{mounted(e,t,s){this.el=e,this.config=t,this.tooltip=null,this.content=t.content||"",this.placement=t.placement||"top",this.delay=t.delay||200,this._bindEvents()}updated(e,t,s){this.content=t.content||"",this.placement=t.placement||"top",this.tooltip&&(this.tooltip.textContent=this.content)}destroyed(e){this._unbindEvents(),this._hideTooltip()}_bindEvents(){this._onMouseEnter=this._handleMouseEnter.bind(this),this._onMouseLeave=this._handleMouseLeave.bind(this),this.el.addEventListener("mouseenter",this._onMouseEnter),this.el.addEventListener("mouseleave",this._onMouseLeave)}_unbindEvents(){this.el.removeEventListener("mouseenter",this._onMouseEnter),this.el.removeEventListener("mouseleave",this._onMouseLeave)}_handleMouseEnter(){this._showTimer=setTimeout(()=>{this._showTooltip()},this.delay)}_handleMouseLeave(){clearTimeout(this._showTimer),this._hideTooltip()}_showTooltip(){this.content&&(this.tooltip=document.createElement("div"),this.tooltip.className="vango-tooltip",this.tooltip.textContent=this.content,this.tooltip.style.cssText=`
            position: fixed;
            z-index: 10000;
            padding: 4px 8px;
            background: #333;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
        `,document.body.appendChild(this.tooltip),this._position())}_position(){if(!this.tooltip)return;let e=this.el.getBoundingClientRect(),t=this.tooltip.getBoundingClientRect(),s,n;switch(this.placement){case"top":s=e.top-t.height-8,n=e.left+(e.width-t.width)/2;break;case"bottom":s=e.bottom+8,n=e.left+(e.width-t.width)/2;break;case"left":s=e.top+(e.height-t.height)/2,n=e.left-t.width-8;break;case"right":s=e.top+(e.height-t.height)/2,n=e.right+8;break;default:s=e.top-t.height-8,n=e.left+(e.width-t.width)/2}this.tooltip.style.top=`${s}px`,this.tooltip.style.left=`${n}px`}_hideTooltip(){this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}};var C=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.closeOnEscape=t.closeOnEscape!==!1,this.closeOnClickOutside=t.closeOnClickOutside!==!1,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(e){this._unbindEvents()}_bindEvents(){this._onClickOutside=this._handleClickOutside.bind(this),this._onKeyDown=this._handleKeyDown.bind(this),setTimeout(()=>{document.addEventListener("click",this._onClickOutside),document.addEventListener("keydown",this._onKeyDown)},0)}_unbindEvents(){document.removeEventListener("click",this._onClickOutside),document.removeEventListener("keydown",this._onKeyDown)}_handleClickOutside(e){this.closeOnClickOutside&&(this.el.contains(e.target)||this.pushEvent("close",{}))}_handleKeyDown(e){this.closeOnEscape&&e.key==="Escape"&&(e.preventDefault(),this.pushEvent("close",{}))}};var A=class{mounted(e,t,s){this.el=e,this.pushEvent=s,this.active=t.active!==!1,this.restoreFocusTo=document.activeElement,this._onKeyDown=this._handleKeyDown.bind(this),this.el.addEventListener("keydown",this._onKeyDown),this.active&&this._focusFirst()}updated(e,t,s){this.active=t.active!==!1,this.pushEvent=s}destroyed(e){this.el.removeEventListener("keydown",this._onKeyDown),this.restoreFocusTo&&typeof this.restoreFocusTo.focus=="function"&&this.restoreFocusTo.focus()}_handleKeyDown(e){if(!this.active||e.key!=="Tab")return;let t=this._getFocusableElements();if(t.length===0){e.preventDefault();return}let s=t[0],n=t[t.length-1];e.shiftKey?document.activeElement===s&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),s.focus())}_focusFirst(){let e=this._getFocusableElements();e.length>0?e[0].focus():(this.el.setAttribute("tabindex","-1"),this.el.focus())}_getFocusableElements(){return this.el.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')}};var M=class{mounted(e,t,s){this.el=e,this.pushEvent=s,this.target=t.target||"body",this.placeholder=document.createComment("portal-placeholder"),e.parentNode&&e.parentNode.insertBefore(this.placeholder,e);let n=document.getElementById("vango-portal-root");n||(n=document.createElement("div"),n.id="vango-portal-root",n.style.cssText="position: relative; z-index: 9999;",document.body.appendChild(n)),n.appendChild(e)}updated(e,t,s){this.pushEvent=s}destroyed(e){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.parentNode.insertBefore(this.el,this.placeholder),this.placeholder.remove())}};function H(){if(typeof document=="undefined")return;let a=document.getElementById("vango-portal-root");return a||(a=document.createElement("div"),a.id="vango-portal-root",a.style.cssText="position: relative; z-index: 9999;",document.body.appendChild(a)),a}var L=class{constructor(e){this.client=e,this.instances=new Map,this.hooks={Sortable:S,Draggable:k,Tooltip:w,Dropdown:C,FocusTrap:A,Portal:M}}register(e,t){this.hooks[e]=t}initializeFromDOM(){document.querySelectorAll("[data-hook]").forEach(e=>{this.initializeForNode(e)})}updateFromDOM(){document.querySelectorAll("[data-hook]").forEach(e=>{let t=e.dataset.hid;t&&!this.instances.has(t)&&this.initializeForNode(e)})}initializeForNode(e){let t=e.dataset.hook;if(!t)return;let s=this.hooks[t];if(!s){this.client.options.debug&&console.warn("[Vango] Unknown hook:",t);return}let n=e.dataset.hid;if(!n){this.client.options.debug&&console.warn("[Vango] Hook element must have data-hid");return}if(this.instances.has(n))return;let i={};try{e.dataset.hookConfig&&(i=JSON.parse(e.dataset.hookConfig))}catch(o){this.client.options.debug&&console.warn("[Vango] Invalid hook config:",o)}let l=(o,d={})=>{this.client.sendHookEvent(n,o,d)},h=new s;h.mounted(e,i,l),this.instances.set(n,{hook:s,instance:h,el:e})}destroyForNode(e){var n;let t=(n=e.dataset)==null?void 0:n.hid;if(!t)return;let s=this.instances.get(t);s&&(s.instance.destroyed&&s.instance.destroyed(s.el),this.instances.delete(t))}destroyAll(){for(let[e,t]of this.instances)t.instance.destroyed&&t.instance.destroyed(t.el);this.instances.clear()}updateConfig(e,t){let s=this.instances.get(e);if(s&&s.instance.updated){let n=(i,l={})=>{this.client.sendHookEvent(e,i,l)};s.instance.updated(s.el,t,n)}}};var O={HANDSHAKE:0,EVENT:1,PATCHES:2,CONTROL:3,ACK:4,ERROR:5},I={PING:1,PONG:2,RESYNC:3,CLOSE:4},_=class{constructor(e={}){this.options={wsUrl:e.wsUrl||this._defaultWsUrl(),reconnect:e.reconnect!==!1,reconnectInterval:e.reconnectInterval||1e3,reconnectMaxInterval:e.reconnectMaxInterval||3e4,heartbeatInterval:e.heartbeatInterval||3e4,debug:e.debug||!1,...e},this.codec=new y,this.nodeMap=new Map,this.connected=!1,this.seq=0,this.wsManager=new b(this,this.options),this.patchApplier=new T(this),this.eventCapture=new f(this),this.optimistic=new x(this),this.hooks=new L(this),this.onConnect=e.onConnect||(()=>{}),this.onDisconnect=e.onDisconnect||(()=>{}),this.onError=e.onError||(t=>console.error("[Vango]",t)),H(),this._buildNodeMap(),this.wsManager.connect(this.options.wsUrl),this.eventCapture.attach(),this.hooks.initializeFromDOM()}_buildNodeMap(){document.querySelectorAll("[data-hid]").forEach(e=>{let t=e.dataset.hid;this.nodeMap.set(t,e)}),this.options.debug&&console.log(`[Vango] Mapped ${this.nodeMap.size} nodes`)}_defaultWsUrl(){return`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/_vango/live`}_onConnected(){this.connected=!0,this.onConnect()}_onDisconnected(){this.connected=!1,this.onDisconnect()}_onError(e){this.onError(e)}_handleBinaryMessage(e){if(e.length<4)return;let t=e[0],s=e[2]<<8|e[3],n=e.slice(4,4+s);switch(t){case O.PATCHES:this._handlePatches(n);break;case O.CONTROL:this._handleControl(n);break;case O.ERROR:this._handleServerError(n);break;default:this.options.debug&&console.warn("[Vango] Unknown frame type:",t)}}_handlePatches(e){let{seq:t,patches:s}=this.codec.decodePatches(e);if(this.options.debug){console.log("[Vango] Received patches buffer, length:",e.length,"bytes:",Array.from(e.slice(0,20))),console.log("[Vango] Decoded",s.length,"patches, seq:",t);for(let n of s)console.log("[Vango] Patch:",n);console.log("[Vango] Applying",s.length,"patches (seq:",t,")")}this.optimistic.clearPending(),this.patchApplier.apply(s),this.hooks.updateFromDOM()}_handleControl(e){if(e.length===0)return;switch(e[0]){case I.PONG:this.options.debug&&console.log("[Vango] Pong received");break;case I.RESYNC:this._handleResync();break;case I.CLOSE:this.wsManager.close();break}}_handleResync(){this.options.debug&&console.log("[Vango] Resync requested, reloading page"),location.reload()}_handleServerError(e){if(e.length<3)return;let t=e[0]<<8|e[1],s=e[2]===1,n=e.slice(3),{value:i}=this.codec.decodeString(n,0),h={1:"Session expired",2:"Invalid event",3:"Rate limited",4:"Server error",5:"Handler panic",6:"Invalid CSRF"}[t]||i||`Unknown error: ${t}`,o=new Error(h);o.code=t,o.fatal=s,this.onError(o),this.optimistic.revertAll(),s&&this.wsManager.close()}sendEvent(e,t,s=null){this.connected||this.options.debug&&console.log("[Vango] Not connected, queueing event"),this.seq++;let n=this.codec.encodeEvent(this.seq,e,t,s),i=this._encodeFrame(O.EVENT,n);this.wsManager.send(i),this.options.debug&&console.log("[Vango] Sent event:",{type:e,hid:t,data:s,seq:this.seq})}_encodeFrame(e,t){let s=t.length,n=new Uint8Array(4+s);return n[0]=e,n[1]=0,n[2]=s>>8&255,n[3]=s&255,n.set(t,4),n}sendHookEvent(e,t,s={}){this.sendEvent(r.HOOK,e,{name:t,data:s})}getNode(e){return this.nodeMap.get(e)}registerNode(e,t){this.nodeMap.set(e,t)}unregisterNode(e){this.nodeMap.delete(e)}registerHook(e,t){this.hooks.register(e,t)}destroy(){this.eventCapture.detach(),this.hooks.destroyAll(),this.wsManager.close()}};function V(){if(window.__vango__)return;let a=document.currentScript||document.querySelector("script[data-vango]"),e={};a&&(a.dataset.wsUrl&&(e.wsUrl=a.dataset.wsUrl),a.dataset.debug&&(e.debug=a.dataset.debug==="true")),window.__vango__=new _(e)}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",V):V());var $=_;return z(j);})();
