var Vango=(()=>{var X=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var re=(c,e)=>{for(var t in e)X(c,t,{get:e[t],enumerable:!0})},he=(c,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ie(e))!oe.call(c,n)&&n!==t&&X(c,n,{get:()=>e[n],enumerable:!(s=ne(e,n))||s.enumerable});return c};var ae=c=>he(X({},"__esModule",{value:!0}),c);var le={};re(le,{ConnectionManager:()=>E,ConnectionState:()=>p,EventType:()=>l,VangoClient:()=>x,default:()=>ce});function m(c){let e=0;for(let n=0;n<c.length;n++)e+=c[n].length;let t=new Uint8Array(e),s=0;for(let n=0;n<c.length;n++)t.set(c[n],s),s+=c[n].length;return t}var l={CLICK:1,DBLCLICK:2,MOUSEDOWN:3,MOUSEUP:4,MOUSEMOVE:5,MOUSEENTER:6,MOUSELEAVE:7,INPUT:16,CHANGE:17,SUBMIT:18,FOCUS:19,BLUR:20,KEYDOWN:32,KEYUP:33,KEYPRESS:34,SCROLL:48,RESIZE:49,TOUCHSTART:64,TOUCHMOVE:65,TOUCHEND:66,DRAGSTART:80,DRAGEND:81,DROP:82,HOOK:96,NAVIGATE:112,CUSTOM:255},a={SET_TEXT:1,SET_ATTR:2,REMOVE_ATTR:3,INSERT_NODE:4,REMOVE_NODE:5,MOVE_NODE:6,REPLACE_NODE:7,SET_VALUE:8,SET_CHECKED:9,SET_SELECTED:10,FOCUS:11,BLUR:12,SCROLL_TO:13,ADD_CLASS:16,REMOVE_CLASS:17,TOGGLE_CLASS:18,SET_STYLE:19,REMOVE_STYLE:20,SET_DATA:21,DISPATCH:32,URL_PUSH:48,URL_REPLACE:49,NAV_PUSH:50,NAV_REPLACE:51},f={CTRL:1,SHIFT:2,ALT:4,META:8},G={ELEMENT:1,TEXT:2,FRAGMENT:3},_={NULL:0,BOOL:1,INT:2,FLOAT:3,STRING:4,ARRAY:5,OBJECT:6},k=class{constructor(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}encodeEvent(e,t,s,n=null){let i=[];switch(i.push(this.encodeUvarint(e)),i.push(new Uint8Array([t])),i.push(this.encodeString(s)),t){case l.INPUT:case l.CHANGE:i.push(this.encodeString((n==null?void 0:n.value)||""));break;case l.SUBMIT:this.encodeFormData(i,n);break;case l.KEYDOWN:case l.KEYUP:case l.KEYPRESS:this.encodeKeyboardEvent(i,n);break;case l.MOUSEDOWN:case l.MOUSEUP:case l.MOUSEMOVE:this.encodeMouseEvent(i,n);break;case l.SCROLL:this.encodeScrollEvent(i,n);break;case l.RESIZE:this.encodeResizeEvent(i,n);break;case l.TOUCHSTART:case l.TOUCHMOVE:case l.TOUCHEND:this.encodeTouchEvent(i,n);break;case l.DRAGSTART:case l.DRAGEND:case l.DROP:this.encodeDragEvent(i,n);break;case l.HOOK:this.encodeHookEvent(i,n);break;case l.NAVIGATE:i.push(this.encodeString((n==null?void 0:n.path)||"")),i.push(new Uint8Array([n!=null&&n.replace?1:0]));break;case l.CUSTOM:i.push(this.encodeString((n==null?void 0:n.name)||"")),i.push(this.encodeLenBytes((n==null?void 0:n.data)||new Uint8Array(0)));break;case l.CLICK:case l.DBLCLICK:case l.FOCUS:case l.BLUR:case l.MOUSEENTER:case l.MOUSELEAVE:default:break}return m(i)}decodePatches(e){let t=0,{value:s,bytesRead:n}=this.decodeUvarint(e,t);t+=n;let{value:i,bytesRead:o}=this.decodeUvarint(e,t);t+=o;let r=[];for(let h=0;h<i;h++){let{patch:d,bytesRead:u}=this.decodePatch(e,t);r.push(d),t+=u}return{seq:s,patches:r}}decodePatch(e,t){let s=t,n={};n.type=e[t++];let{value:i,bytesRead:o}=this.decodeString(e,t);switch(n.hid=i,t+=o,n.type){case a.SET_TEXT:case a.SET_VALUE:{let{value:r,bytesRead:h}=this.decodeString(e,t);n.value=r,t+=h;break}case a.SET_ATTR:case a.SET_STYLE:case a.SET_DATA:{let{value:r,bytesRead:h}=this.decodeString(e,t);t+=h;let{value:d,bytesRead:u}=this.decodeString(e,t);t+=u,n.key=r,n.value=d;break}case a.REMOVE_ATTR:case a.REMOVE_STYLE:{let{value:r,bytesRead:h}=this.decodeString(e,t);n.key=r,t+=h;break}case a.ADD_CLASS:case a.REMOVE_CLASS:case a.TOGGLE_CLASS:{let{value:r,bytesRead:h}=this.decodeString(e,t);n.className=r,t+=h;break}case a.INSERT_NODE:{let{value:r,bytesRead:h}=this.decodeString(e,t);t+=h;let{value:d,bytesRead:u}=this.decodeUvarint(e,t);t+=u;let{vnode:g,bytesRead:v}=this.decodeVNode(e,t);t+=v,n.parentID=r,n.index=d,n.vnode=g;break}case a.REMOVE_NODE:break;case a.MOVE_NODE:{let{value:r,bytesRead:h}=this.decodeString(e,t);t+=h;let{value:d,bytesRead:u}=this.decodeUvarint(e,t);t+=u,n.parentID=r,n.index=d;break}case a.REPLACE_NODE:{let{vnode:r,bytesRead:h}=this.decodeVNode(e,t);t+=h,n.vnode=r;break}case a.SET_CHECKED:case a.SET_SELECTED:{n.value=e[t++]===1;break}case a.FOCUS:case a.BLUR:break;case a.SCROLL_TO:{let{value:r,bytesRead:h}=this.decodeSvarint(e,t);t+=h;let{value:d,bytesRead:u}=this.decodeSvarint(e,t);t+=u,n.x=r,n.y=d,n.behavior=e[t++];break}case a.DISPATCH:{let{value:r,bytesRead:h}=this.decodeString(e,t);t+=h;let{value:d,bytesRead:u}=this.decodeString(e,t);t+=u,n.eventName=r,n.detail=d;break}case a.URL_PUSH:case a.URL_REPLACE:{let{value:r,bytesRead:h}=this.decodeUvarint(e,t);t+=h,n.params={};for(let d=0;d<r;d++){let{value:u,bytesRead:g}=this.decodeString(e,t);t+=g;let{value:v,bytesRead:y}=this.decodeString(e,t);t+=y,n.params[u]=v}n.op=n.type;break}case a.NAV_PUSH:case a.NAV_REPLACE:{let{value:r,bytesRead:h}=this.decodeString(e,t);t+=h,n.path=r;break}default:break}return{patch:n,bytesRead:t-s}}decodeVNode(e,t){let s=t,n={};switch(e[t++]){case G.ELEMENT:{n.type="element";let{value:o,bytesRead:r}=this.decodeString(e,t);n.tag=o,t+=r;let{value:h,bytesRead:d}=this.decodeString(e,t);n.hid=h||null,t+=d;let{value:u,bytesRead:g}=this.decodeUvarint(e,t);t+=g,n.attrs={};for(let S=0;S<u;S++){let{value:z,bytesRead:W}=this.decodeString(e,t);t+=W;let{value:te,bytesRead:se}=this.decodeString(e,t);t+=se,n.attrs[z]=te}let{value:v,bytesRead:y}=this.decodeUvarint(e,t);t+=y,n.children=[];for(let S=0;S<v;S++){let{vnode:z,bytesRead:W}=this.decodeVNode(e,t);n.children.push(z),t+=W}break}case G.TEXT:{n.type="text";let{value:o,bytesRead:r}=this.decodeString(e,t);n.text=o,t+=r;break}case G.FRAGMENT:{n.type="fragment";let{value:o,bytesRead:r}=this.decodeUvarint(e,t);t+=r,n.children=[];for(let h=0;h<o;h++){let{vnode:d,bytesRead:u}=this.decodeVNode(e,t);n.children.push(d),t+=u}break}default:n.type="unknown"}return{vnode:n,bytesRead:t-s}}encodeString(e){let t=this.textEncoder.encode(e),s=this.encodeUvarint(t.length);return m([s,t])}decodeString(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t),i=e.slice(t+n,t+n+s);return{value:this.textDecoder.decode(i),bytesRead:n+s}}encodeUvarint(e){let t=[];for(;e>127;)t.push(e&127|128),e>>>=7;return t.push(e&127),new Uint8Array(t)}decodeUvarint(e,t){let s=0,n=0,i=0;for(;;){let o=e[t+i];if(i++,s|=(o&127)<<n,!(o&128))break;n+=7}return{value:s,bytesRead:i}}encodeSvarint(e){let t=e<<1^e>>31;return this.encodeUvarint(t>>>0)}decodeSvarint(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t);return{value:s>>>1^-(s&1),bytesRead:n}}encodeLenBytes(e){let t=this.encodeUvarint(e.length);return m([t,e])}decodeLenBytes(e,t){let{value:s,bytesRead:n}=this.decodeUvarint(e,t);return{value:e.slice(t+n,t+n+s),bytesRead:n+s}}encodeFormData(e,t){if(!t){e.push(this.encodeUvarint(0));return}let s=[];if(t instanceof FormData)for(let[n,i]of t.entries())s.push({key:n,value:String(i)});else if(typeof t=="object")for(let[n,i]of Object.entries(t))s.push({key:n,value:String(i)});e.push(this.encodeUvarint(s.length));for(let{key:n,value:i}of s)e.push(this.encodeString(n)),e.push(this.encodeString(i))}encodeKeyboardEvent(e,t){e.push(this.encodeString((t==null?void 0:t.key)||"")),e.push(this.encodeString((t==null?void 0:t.code)||""));let s=0;t!=null&&t.ctrlKey&&(s|=f.CTRL),t!=null&&t.shiftKey&&(s|=f.SHIFT),t!=null&&t.altKey&&(s|=f.ALT),t!=null&&t.metaKey&&(s|=f.META),e.push(new Uint8Array([s])),e.push(new Uint8Array([t!=null&&t.repeat?1:0])),e.push(new Uint8Array([(t==null?void 0:t.location)||0]))}encodeMouseEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.clientX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.clientY)||0)),e.push(this.encodeSvarint((t==null?void 0:t.pageX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.pageY)||0)),e.push(this.encodeSvarint((t==null?void 0:t.offsetX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.offsetY)||0)),e.push(new Uint8Array([(t==null?void 0:t.button)||0])),e.push(new Uint8Array([(t==null?void 0:t.buttons)||0]));let s=0;t!=null&&t.ctrlKey&&(s|=f.CTRL),t!=null&&t.shiftKey&&(s|=f.SHIFT),t!=null&&t.altKey&&(s|=f.ALT),t!=null&&t.metaKey&&(s|=f.META),e.push(new Uint8Array([s]))}encodeScrollEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.scrollTop)||0)),e.push(this.encodeSvarint((t==null?void 0:t.scrollLeft)||0))}encodeResizeEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.width)||0)),e.push(this.encodeSvarint((t==null?void 0:t.height)||0))}encodeTouchEvent(e,t){let s=(t==null?void 0:t.touches)||[];e.push(this.encodeUvarint(s.length));for(let o of s)e.push(this.encodeSvarint(o.identifier||o.id||0)),e.push(this.encodeSvarint(o.clientX||0)),e.push(this.encodeSvarint(o.clientY||0)),e.push(this.encodeSvarint(o.pageX||0)),e.push(this.encodeSvarint(o.pageY||0));let n=(t==null?void 0:t.targetTouches)||[];e.push(this.encodeUvarint(n.length));for(let o of n)e.push(this.encodeSvarint(o.identifier||o.id||0)),e.push(this.encodeSvarint(o.clientX||0)),e.push(this.encodeSvarint(o.clientY||0)),e.push(this.encodeSvarint(o.pageX||0)),e.push(this.encodeSvarint(o.pageY||0));let i=(t==null?void 0:t.changedTouches)||[];e.push(this.encodeUvarint(i.length));for(let o of i)e.push(this.encodeSvarint(o.identifier||o.id||0)),e.push(this.encodeSvarint(o.clientX||0)),e.push(this.encodeSvarint(o.clientY||0)),e.push(this.encodeSvarint(o.pageX||0)),e.push(this.encodeSvarint(o.pageY||0))}encodeDragEvent(e,t){e.push(this.encodeSvarint((t==null?void 0:t.clientX)||0)),e.push(this.encodeSvarint((t==null?void 0:t.clientY)||0));let s=0;t!=null&&t.ctrlKey&&(s|=f.CTRL),t!=null&&t.shiftKey&&(s|=f.SHIFT),t!=null&&t.altKey&&(s|=f.ALT),t!=null&&t.metaKey&&(s|=f.META),e.push(new Uint8Array([s]))}encodeHookEvent(e,t){e.push(this.encodeString((t==null?void 0:t.name)||"")),this.encodeHookData(e,(t==null?void 0:t.data)||{})}encodeHookData(e,t){let s=Object.entries(t);e.push(this.encodeUvarint(s.length));for(let[n,i]of s)e.push(this.encodeString(n)),this.encodeHookValue(e,i)}encodeHookValue(e,t){if(t==null)e.push(new Uint8Array([_.NULL]));else if(typeof t=="boolean")e.push(new Uint8Array([_.BOOL,t?1:0]));else if(typeof t=="number"&&Number.isInteger(t))e.push(new Uint8Array([_.INT])),e.push(this.encodeSvarint(t));else if(typeof t=="number")e.push(new Uint8Array([_.FLOAT])),e.push(this.encodeFloat64(t));else if(typeof t=="string")e.push(new Uint8Array([_.STRING])),e.push(this.encodeString(t));else if(Array.isArray(t)){e.push(new Uint8Array([_.ARRAY])),e.push(this.encodeUvarint(t.length));for(let s of t)this.encodeHookValue(e,s)}else if(typeof t=="object"){e.push(new Uint8Array([_.OBJECT]));let s=Object.entries(t);e.push(this.encodeUvarint(s.length));for(let[n,i]of s)e.push(this.encodeString(n)),this.encodeHookValue(e,i)}else e.push(new Uint8Array([_.NULL]))}encodeFloat64(e){let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),new Uint8Array(t)}encodeClientHello(e={}){let t=[];t.push(new Uint8Array([2,0])),t.push(this.encodeString(e.csrf||"")),t.push(this.encodeString(e.sessionId||"")),t.push(this.encodeUint32(e.lastSeq||0)),t.push(this.encodeUint16(e.viewportW||window.innerWidth)),t.push(this.encodeUint16(e.viewportH||window.innerHeight));let s=new Date().getTimezoneOffset();return t.push(this.encodeInt16(-s)),m(t)}encodeClientHelloFrame(e={}){let t=this.encodeClientHello(e),s=new Uint8Array(4+t.length);return s[0]=0,s[1]=0,s[2]=t.length>>8&255,s[3]=t.length&255,s.set(t,4),s}decodeServerHello(e){if(e.length<5)return{error:"Buffer too short"};let t=e[0];if(t!==0)return{error:`Unexpected frame type: ${t}`};let s=4,n=e[s++],{value:i,bytesRead:o}=this.decodeString(e,s);s+=o;let r=this.decodeUint32(e,s);s+=4;let h=this.decodeUint64(e,s);s+=8;let d=this.decodeUint16(e,s);return{status:n,sessionId:i,nextSeq:r,serverTime:h,flags:d,ok:n===0}}encodeUint16(e){return new Uint8Array([e>>8&255,e&255])}decodeUint16(e,t){return e[t]<<8|e[t+1]}encodeInt16(e){return this.encodeUint16(e&65535)}encodeUint32(e){return new Uint8Array([e>>24&255,e>>16&255,e>>8&255,e&255])}decodeUint32(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}decodeUint64(e,t){let s=this.decodeUint32(e,t),n=this.decodeUint32(e,t+4);return s*4294967296+n}encodeAck(e,t=100){return m([this.encodeUvarint(e),this.encodeUvarint(t)])}encodeResyncRequest(e){return m([new Uint8Array([16]),this.encodeUvarint(e)])}};var C=class{constructor(e,t={}){this.client=e,this.options={reconnect:t.reconnect!==!1,reconnectInterval:t.reconnectInterval||1e3,reconnectMaxInterval:t.reconnectMaxInterval||3e4,heartbeatInterval:t.heartbeatInterval||3e4,...t},this.ws=null,this.connected=!1,this.handshakeComplete=!1,this.sessionId=null,this.lastSeq=0,this.reconnectAttempts=0,this.heartbeatTimer=null,this.messageQueue=[];let s=this._loadResumeInfo();s&&(this.sessionId=s.sessionId,this.lastSeq=s.lastSeq)}connect(e){this.ws&&this.ws.close(),this.url=e,this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>this._onOpen(),this.ws.onclose=t=>this._onClose(t),this.ws.onerror=t=>this._onError(t),this.ws.onmessage=t=>this._onMessage(t)}_onOpen(){this.client.options.debug&&console.log("[Vango] WebSocket connected"),this.reconnectAttempts=0,this._sendHandshake(),this._startHeartbeat()}_sendHandshake(){let e=this.client.codec.encodeClientHelloFrame({csrf:this._getCSRFToken(),sessionId:this.sessionId||"",lastSeq:this.lastSeq||this.client.patchSeq||0,viewportW:window.innerWidth,viewportH:window.innerHeight});this.ws.send(e),this.client.options.debug&&console.log("[Vango] Sent framed ClientHello")}_getCSRFToken(){if(window.__VANGO_CSRF__)return window.__VANGO_CSRF__;let e=document.cookie.match(/(?:^|;\s*)__vango_csrf=([^;]*)/);return e?decodeURIComponent(e[1]):""}_onMessage(e){if(!(e.data instanceof ArrayBuffer)){this.client.options.debug&&console.warn("[Vango] Received non-binary message:",e.data);return}let t=new Uint8Array(e.data);if(!this.handshakeComplete){let s=this.client.codec.decodeServerHello(t);if(s.error){this.client.options.debug&&console.error("[Vango] Handshake error:",s.error),this.client._onError(new Error(s.error));return}if(!s.ok){let i={1:"Version mismatch",2:"Invalid CSRF token",3:"Session expired",4:"Server busy",5:"Upgrade required",6:"Invalid format",7:"Not authorized",8:"Internal error"}[s.status]||`Handshake failed: ${s.status}`;this.client._onError(new Error(i)),(s.status===3||s.status===7)&&(this._clearResumeInfo(),this.sessionId=null,this.lastSeq=0),this.ws.close();return}this.handshakeComplete=!0,this.connected=!0,this.sessionId=s.sessionId,this._persistResumeInfo(this.sessionId,this.lastSeq||this.client.patchSeq||0),this.client._onConnected(),this._flushQueue(),this.client.options.debug&&console.log("[Vango] Handshake complete, session:",this.sessionId);return}this.client._handleBinaryMessage(t)}_onClose(e){var n;let t=this.connected;this.connected=!1,this.handshakeComplete=!1,this._stopHeartbeat(),this.client.options.debug&&console.log("[Vango] WebSocket closed:",e.code,e.reason);let s=(n=this.client.eventCapture)==null?void 0:n.pendingNavPath;if(t&&s){console.log("[Vango] Connection lost during navigation, completing via location.assign:",s),location.assign(s);return}t&&this.client._onDisconnected(),this.options.reconnect&&!e.wasClean&&this._scheduleReconnect()}_onError(e){this.client.options.debug&&console.error("[Vango] WebSocket error:",e),this.client._onError(new Error("WebSocket error"))}_scheduleReconnect(){let e=Math.min(this.options.reconnectInterval*Math.pow(2,this.reconnectAttempts),this.options.reconnectMaxInterval);this.reconnectAttempts++,this.client.options.debug&&console.log(`[Vango] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>this.connect(this.url),e)}_startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.connected&&this._sendPing()},this.options.heartbeatInterval)}_stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}_sendPing(){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let e=Date.now(),t=new Uint8Array(9);t[0]=1;let s=e;for(let i=0;i<8;i++)t[1+i]=s&255,s=Math.floor(s/256);let n=new Uint8Array(4+t.length);n[0]=3,n[1]=0,n[2]=t.length>>8&255,n[3]=t.length&255,n.set(t,4),this.ws.send(n)}}send(e){return this.connected&&this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(e),!0):(this.messageQueue.push(e),!1)}_flushQueue(){for(;this.messageQueue.length>0&&this.connected;){let e=this.messageQueue.shift();this.ws.send(e)}}close(){this.options.reconnect=!1,this._stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Client closing"),this.ws=null)}updateLastSeq(e){let t=Number(e);!Number.isFinite(t)||t<0||(this.lastSeq=t,this.sessionId&&this._persistResumeInfo(this.sessionId,this.lastSeq))}_storageAvailable(){try{return typeof sessionStorage!="undefined"}catch(e){return!1}}_loadResumeInfo(){if(!this._storageAvailable())return null;try{let e=sessionStorage.getItem("__vango_session_id")||"";if(!e)return null;let t=sessionStorage.getItem("__vango_last_seq")||"0",s=Number(t);return{sessionId:e,lastSeq:Number.isFinite(s)&&s>=0?s:0}}catch(e){return null}}_persistResumeInfo(e,t){if(this._storageAvailable())try{sessionStorage.setItem("__vango_session_id",e||""),sessionStorage.setItem("__vango_last_seq",String(t||0))}catch(s){}}_clearResumeInfo(){if(this._storageAvailable())try{sessionStorage.removeItem("__vango_session_id"),sessionStorage.removeItem("__vango_last_seq")}catch(e){}}};var T=class{constructor(e){this.client=e,this.handlers=new Map,this.debounceTimers=new Map,this.scrollThrottled=new Set,this.prefetchedPaths=new Set}attach(){this._on("click",this._handleClick.bind(this)),this._on("dblclick",this._handleDblClick.bind(this)),this._on("input",this._handleInput.bind(this)),this._on("change",this._handleChange.bind(this)),this._on("submit",this._handleSubmit.bind(this)),this._on("focus",this._handleFocus.bind(this),!0),this._on("blur",this._handleBlur.bind(this),!0),this._on("keydown",this._handleKeyDown.bind(this)),this._on("keyup",this._handleKeyUp.bind(this)),this._on("mouseenter",this._handleMouseEnter.bind(this),!0),this._on("mouseleave",this._handleMouseLeave.bind(this),!0),this._on("scroll",this._handleScroll.bind(this),!0),this._on("click",this._handleLinkClick.bind(this)),window.addEventListener("popstate",this._handlePopState.bind(this)),this._on("mouseenter",this._handlePrefetch.bind(this),!0)}detach(){for(let[e,{handler:t,capture:s}]of this.handlers)document.removeEventListener(e,t,s);this.handlers.clear();for(let e of this.debounceTimers.values())clearTimeout(e);this.debounceTimers.clear()}_on(e,t,s=!1){document.addEventListener(e,t,{capture:s,passive:!1}),this.handlers.set(`${e}-${s}`,{handler:t,capture:s})}_findHidElement(e){return!e||!e.closest?null:e.closest("[data-hid]")}_closest(e,t){return!e||typeof e.closest!="function"?null:e.closest(t)}_hasEvent(e,t){return(e.dataset.ve||"").split(",").map(n=>n.trim()).includes(t)}_getModifiers(e,t){return{preventDefault:e.dataset[`pd${this._capitalize(t)}`]==="true",stopPropagation:e.dataset[`sp${this._capitalize(t)}`]==="true",self:e.dataset[`self${this._capitalize(t)}`]==="true",once:e.dataset[`once${this._capitalize(t)}`]==="true",passive:e.dataset[`passive${this._capitalize(t)}`]==="true",capture:e.dataset[`capture${this._capitalize(t)}`]==="true",debounce:parseInt(e.dataset[`debounce${this._capitalize(t)}`]||e.dataset.debounce||"0",10),throttle:parseInt(e.dataset[`throttle${this._capitalize(t)}`]||e.dataset.throttle||"0",10)}}_capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}_applyModifiers(e,t,s){let n=this._getModifiers(t,s);if(n.self&&e.target!==t)return!1;if(n.passive){let i=e.preventDefault.bind(e);e.preventDefault=()=>{console.warn("[Vango] preventDefault() called on passive handler - ignored")},queueMicrotask(()=>{e.preventDefault=i})}else n.preventDefault&&e.preventDefault();if(n.stopPropagation&&e.stopPropagation(),n.once){let o=(t.dataset.ve||"").split(",").map(r=>r.trim()).filter(r=>r!==s);o.length>0?t.dataset.ve=o.join(","):delete t.dataset.ve}return!0}_getDebounce(e,t){let s=this._getModifiers(e,t);return t==="input"&&s.debounce===0?100:s.debounce}_getThrottle(e,t){let s=this._getModifiers(e,t);return t==="scroll"&&s.throttle===0?100:s.throttle}_findHidElementWithEvent(e,t){if(!e||!e.closest)return null;let s=e.closest("[data-hid]");for(;s;){if(this._hasEvent(s,t))return s;let n=s.parentElement;if(!n)break;s=n.closest("[data-hid]")}return null}_handleClick(e){if(e.defaultPrevented||e.button!==0||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||!this.client.connected)return;let t=this._findHidElementWithEvent(e.target,"click");if(!t)return;let s=this._closest(e.target,"a[href]");if(s){let n=s.getAttribute("target");if(n&&n!=="_self"||s.hasAttribute("download"))return;let i=s.getAttribute("href");if(i)try{if(new URL(i,location.href).origin!==location.origin)return}catch(o){return}}this._applyModifiers(e,t,"click")&&(e.preventDefault(),this.client.optimistic.applyOptimistic(t,"click"),this.client.sendEvent(l.CLICK,t.dataset.hid))}_handleDblClick(e){let t=this._findHidElement(e.target);if(!t||!this._hasEvent(t,"dblclick")||!this._applyModifiers(e,t,"dblclick"))return;let s=this._getModifiers(t,"dblclick");!s.preventDefault&&!s.passive&&e.preventDefault(),this.client.sendEvent(l.DBLCLICK,t.dataset.hid)}_handleInput(e){let t=this._findHidElement(e.target);if(!t||!this._hasEvent(t,"input")||!this._applyModifiers(e,t,"input"))return;let s=t.dataset.hid,n=this._getDebounce(t,"input");if(this.debounceTimers.has(s)&&clearTimeout(this.debounceTimers.get(s)),n===0){this.client.sendEvent(l.INPUT,s,{value:t.value});return}let i=setTimeout(()=>{this.debounceTimers.delete(s),this.client.sendEvent(l.INPUT,s,{value:t.value})},n);this.debounceTimers.set(s,i)}_handleChange(e){let t=this._findHidElement(e.target);if(!t||!this._hasEvent(t,"change")||!this._applyModifiers(e,t,"change"))return;let s;t.type==="checkbox"?s=t.checked?"true":"false":t.type==="radio"?s=t.checked?t.value:"":t.tagName==="SELECT"&&t.multiple?s=Array.from(t.selectedOptions).map(n=>n.value).join(","):s=t.value,this.client.optimistic.applyOptimistic(t,"change"),this.client.sendEvent(l.CHANGE,t.dataset.hid,{value:s})}_handleSubmit(e){let t=this._closest(e.target,"form[data-hid]");if(!t||!this._hasEvent(t,"submit")||!this.client.connected||e.defaultPrevented)return;e.preventDefault();let s=new FormData(t),n={};for(let[i,o]of s.entries())n[i]=String(o);this.client.sendEvent(l.SUBMIT,t.dataset.hid,n)}_handleFocus(e){let t=this._findHidElement(e.target);!t||!this._hasEvent(t,"focus")||this._applyModifiers(e,t,"focus")&&this.client.sendEvent(l.FOCUS,t.dataset.hid)}_handleBlur(e){let t=this._findHidElement(e.target);!t||!this._hasEvent(t,"blur")||this._applyModifiers(e,t,"blur")&&this.client.sendEvent(l.BLUR,t.dataset.hid)}_handleKeyDown(e){let t=this._findHidElement(e.target);if(!t||!this._hasEvent(t,"keydown"))return;let s=t.dataset.keyFilter;s&&!this._matchesKeyFilter(e,s)||this._applyModifiers(e,t,"keydown")&&this.client.sendEvent(l.KEYDOWN,t.dataset.hid,{key:e.key,code:e.code,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,repeat:e.repeat,location:e.location})}_handleKeyUp(e){let t=this._findHidElement(e.target);!t||!this._hasEvent(t,"keyup")||this._applyModifiers(e,t,"keyup")&&this.client.sendEvent(l.KEYUP,t.dataset.hid,{key:e.key,code:e.code,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,repeat:e.repeat,location:e.location})}_handleMouseEnter(e){let t=this._findHidElement(e.target);!t||!this._hasEvent(t,"mouseenter")||this._applyModifiers(e,t,"mouseenter")&&this.client.sendEvent(l.MOUSEENTER,t.dataset.hid)}_handleMouseLeave(e){let t=this._findHidElement(e.target);!t||!this._hasEvent(t,"mouseleave")||this._applyModifiers(e,t,"mouseleave")&&this.client.sendEvent(l.MOUSELEAVE,t.dataset.hid)}_handleScroll(e){let t=this._findHidElement(e.target);if(!t||!this._hasEvent(t,"scroll")||!this._applyModifiers(e,t,"scroll"))return;let s=t.dataset.hid,n=this._getThrottle(t,"scroll");n>0&&this.scrollThrottled.has(s)||(n>0&&(this.scrollThrottled.add(s),setTimeout(()=>{this.scrollThrottled.delete(s)},n)),this.client.sendEvent(l.SCROLL,s,{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}))}_handleLinkClick(e){let t=this._closest(e.target,"a[href]");if(!t||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||t.hasAttribute("download"))return;let s=t.getAttribute("target");if(s&&s!=="_self"||!(t.hasAttribute("data-vango-link")||t.hasAttribute("data-link")))return;let i=t.getAttribute("href");if(i){if(i.startsWith("http://")||i.startsWith("https://")||i.startsWith("//"))try{if(new URL(i,window.location.origin).origin!==window.location.origin)return}catch(o){return}t.hasAttribute("data-external")||this.client.connected&&(e.preventDefault(),this.pendingNavPath=i,this.client.sendEvent(l.NAVIGATE,"nav",{path:i,replace:!1}))}}_handlePopState(e){if(!this.client.connected)return;let t=location.pathname+location.search;this.pendingNavPath=t,this.client.sendEvent(l.NAVIGATE,"nav",{path:t,replace:!0})}_handlePrefetch(e){let t=this._closest(e.target,"a[data-prefetch][href]");if(!t)return;let s=t.getAttribute("href");if(!s)return;if(s.startsWith("http://")||s.startsWith("https://")||s.startsWith("//"))try{if(new URL(s,window.location.origin).origin!==window.location.origin)return}catch(r){return}if(this.prefetchedPaths.has(s)||!this.client.connected)return;this.prefetchedPaths.add(s);let n=JSON.stringify({path:s}),o=new TextEncoder().encode(n);this.client.sendEvent(l.CUSTOM,"prefetch",{name:"prefetch",data:o}),this.client.options.debug&&console.log("[Vango] Prefetching:",s)}_matchesKeyFilter(e,t){let s=t.split("+"),n=s.pop().toLowerCase(),i=new Set(s.map(u=>u.toLowerCase()));if(e.key.toLowerCase()!==n)return!1;let o=i.has("ctrl")||i.has("control"),r=i.has("shift"),h=i.has("alt"),d=i.has("meta")||i.has("cmd");return!(o!==e.ctrlKey||r!==e.shiftKey||h!==e.altKey||d!==e.metaKey)}};var R=class{constructor(e){this.client=e}apply(e){for(let t of e)this.applyPatch(t)}_requiresTargetNode(e){switch(e){case a.URL_PUSH:case a.URL_REPLACE:case a.NAV_PUSH:case a.NAV_REPLACE:return!1;case a.INSERT_NODE:return!1;default:return!0}}_triggerSelfHeal(){var t;let e=(t=this.client.eventCapture)==null?void 0:t.pendingNavPath;e?(console.log("[Vango] Self-heal: navigating to pending path:",e),location.assign(e)):(console.log("[Vango] Self-heal: reloading page"),location.reload())}applyPatch(e){let t=this.client.getNode(e.hid);if(!t&&this._requiresTargetNode(e.type)){console.error("[Vango] Patch target not found (HID:",e.hid,"type:",e.type,")"),this._triggerSelfHeal();return}switch(e.type){case a.SET_TEXT:this._setText(t,e.value);break;case a.SET_ATTR:this._setAttr(t,e.key,e.value);break;case a.REMOVE_ATTR:this._removeAttr(t,e.key);break;case a.ADD_CLASS:t.classList.add(e.className);break;case a.REMOVE_CLASS:t.classList.remove(e.className);break;case a.TOGGLE_CLASS:t.classList.toggle(e.className);break;case a.SET_STYLE:t.style[e.key]=e.value;break;case a.REMOVE_STYLE:t.style[e.key]="";break;case a.INSERT_NODE:this._insertNode(e.parentID,e.index,e.vnode);break;case a.REMOVE_NODE:this._removeNode(t,e.hid);break;case a.MOVE_NODE:this._moveNode(t,e.parentID,e.index);break;case a.REPLACE_NODE:this._replaceNode(t,e.hid,e.vnode);break;case a.SET_VALUE:this._setValue(t,e.value);break;case a.SET_CHECKED:t.checked=e.value;break;case a.SET_SELECTED:t.selected=e.value;break;case a.FOCUS:t.focus();break;case a.BLUR:t.blur();break;case a.SCROLL_TO:t.scrollTo({left:e.x,top:e.y,behavior:e.behavior===1?"smooth":"instant"});break;case a.SET_DATA:t.dataset[e.key]=e.value;break;case a.DISPATCH:this._dispatchEvent(t,e.eventName,e.detail);break;case a.URL_PUSH:case a.URL_REPLACE:this.client.urlManager&&this.client.urlManager.applyPatch(e);break;case a.NAV_PUSH:case a.NAV_REPLACE:this._applyNavPatch(e);break;default:this.client.options.debug&&console.warn("[Vango] Unknown patch type:",e.type)}}_setText(e,t){e.textContent=t}_setAttr(e,t,s){if(t.length>2&&t.substring(0,2).toLowerCase()==="on"){console.warn("[Vango] Blocked dangerous attribute:",t);return}switch(t){case"class":e.className=s;break;case"for":e.htmlFor=s;break;case"value":this._setValue(e,s);break;case"checked":e.checked=s==="true"||s==="";break;case"selected":e.selected=s==="true"||s==="";break;case"disabled":case"readonly":case"required":case"multiple":case"autofocus":s==="true"||s===""?e.setAttribute(t,""):e.removeAttribute(t);break;default:e.setAttribute(t,s)}}_removeAttr(e,t){switch(t){case"class":e.className="";break;case"for":e.htmlFor="";break;case"value":e.value="";break;case"checked":e.checked=!1;break;case"selected":e.selected=!1;break;default:e.removeAttribute(t)}}_setValue(e,t){if(e.value!==t)if(e.type==="text"||e.tagName==="TEXTAREA"){let s=e.selectionStart,n=e.selectionEnd;e.value=t,document.activeElement===e&&e.setSelectionRange(Math.min(s,t.length),Math.min(n,t.length))}else e.value=t}_insertNode(e,t,s){let n=this.client.getNode(e);if(!n){console.error("[Vango] INSERT_NODE parent not found (parentHID:",e,")"),this._triggerSelfHeal();return}let i=this._createNode(s);t>=n.children.length?n.appendChild(i):n.insertBefore(i,n.children[t])}_removeNode(e,t){this.client.hooks.destroyForNode(e),this.client.unregisterNode(t),e.querySelectorAll("[data-hid]").forEach(s=>{this.client.hooks.destroyForNode(s),this.client.unregisterNode(s.dataset.hid)}),e.remove()}_moveNode(e,t,s){let n=this.client.getNode(t);if(!n){console.error("[Vango] MOVE_NODE parent not found (parentHID:",t,")"),this._triggerSelfHeal();return}s>=n.children.length?n.appendChild(e):n.insertBefore(e,n.children[s])}_replaceNode(e,t,s){this.client.hooks.destroyForNode(e),this.client.unregisterNode(t),e.querySelectorAll("[data-hid]").forEach(i=>{this.client.hooks.destroyForNode(i),this.client.unregisterNode(i.dataset.hid)});let n=this._createNode(s);e.replaceWith(n)}_createNode(e){switch(e.type){case"element":return this._createElement(e);case"text":return document.createTextNode(e.text);case"fragment":return this._createFragment(e);default:return this.client.options.debug&&console.warn("[Vango] Unknown vnode type:",e.type),document.createTextNode("")}}_createElement(e){let t=document.createElement(e.tag);for(let[s,n]of Object.entries(e.attrs||{}))this._setAttr(t,s,n);e.hid&&(t.dataset.hid=e.hid,this.client.registerNode(e.hid,t));for(let s of e.children||[])t.appendChild(this._createNode(s));return this.client.hooks.initializeForNode(t),t}_createFragment(e){let t=document.createDocumentFragment();for(let s of e.children||[])t.appendChild(this._createNode(s));return t}_dispatchEvent(e,t,s){let n=null;if(s)try{n=JSON.parse(s)}catch(r){n=s}if(t==="vango:navigate"){this._handleNavigate(n);return}if(t==="vango:hash"){this._handleHash(n);return}let i=e||document,o=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});i.dispatchEvent(o)}_applyNavPatch(e){let{path:t,type:s}=e;if(!t||!t.startsWith("/")){console.error("[Vango] Invalid navigation path (must start with /):",t);return}if(t.includes("://")||t.startsWith("//")){console.error("[Vango] Invalid navigation path (must be relative):",t);return}s===a.NAV_REPLACE?history.replaceState(null,"",t):history.pushState(null,"",t),this.client.eventCapture&&(this.client.eventCapture.pendingNavPath=null),window.scrollTo({top:0,behavior:"instant"}),this.client.options.debug&&console.log("[Vango] Navigation applied:",t,s===a.NAV_REPLACE?"(replace)":"(push)")}_handleNavigate(e){if(!e||!e.path){this.client.options.debug&&console.warn("[Vango] Invalid navigate data:",e);return}let{path:t,replace:s,scroll:n}=e;s?history.replaceState(null,"",t):history.pushState(null,"",t),this.client.sendEvent(l.NAVIGATE,"nav",{path:t}),n!==!1&&window.scrollTo({top:0,behavior:"instant"}),this.client.options.debug&&console.log("[Vango] Navigated to:",t,{replace:s,scroll:n})}_handleHash(e){if(!e||typeof e.value!="string"){this.client.options.debug&&console.warn("[Vango] Invalid hash data:",e);return}let t=!!e.replace,s=new URL(window.location);e.value===""?s.hash="":e.value.startsWith("#")?s.hash=e.value:s.hash=`#${e.value}`,s.toString()!==window.location.href&&(t?history.replaceState(null,"",s.toString()):history.pushState(null,"",s.toString()))}};var L=class{constructor(e){this.client=e,this.pending=new Map}applyOptimistic(e,t){let s=e.dataset.hid;if(!s)return;let n=e.dataset.optimistic;if(n)try{let i=JSON.parse(n);i.class&&this._applyClassOptimistic(e,s,i.class),i.text&&this._applyTextOptimistic(e,s,i.text),i.attr&&i.value!==void 0&&this._applyAttrOptimistic(e,s,i.attr,i.value)}catch(i){console.warn("[Vango] Invalid optimistic config:",i)}}_applyClassOptimistic(e,t,s){let[n,i="toggle"]=s.split(":"),o=e.classList.contains(n);switch(i){case"add":e.classList.add(n);break;case"remove":e.classList.remove(n);break;case"toggle":default:e.classList.toggle(n)}this._trackPending(t,"class",n,o)}_applyTextOptimistic(e,t,s){let n=e.textContent;e.textContent=s,this._trackPending(t,"text",null,n)}_applyAttrOptimistic(e,t,s,n){if(s.length>2&&s.substring(0,2).toLowerCase()==="on"){console.warn("[Vango] Blocked dangerous optimistic attribute:",s);return}let i=e.getAttribute(s);n==="null"||n===""?e.removeAttribute(s):e.setAttribute(s,n),this._trackPending(t,"attr",s,i)}_trackPending(e,t,s,n){this.pending.has(e)||this.pending.set(e,[]),this.pending.get(e).push({type:t,key:s,original:n})}clearPending(){this.pending.clear()}revertAll(){for(let[e,t]of this.pending){let s=this.client.getNode(e);if(s)for(let n of t)this._revertUpdate(s,n)}this.pending.clear()}_revertUpdate(e,t){switch(t.type){case"class":t.original?e.classList.add(t.key):e.classList.remove(t.key);break;case"text":e.textContent=t.original;break;case"attr":t.original===null?e.removeAttribute(t.key):e.setAttribute(t.key,t.original);break}}};var D=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.animation=t.animation||150,this.handle=t.handle||null,this.ghostClass=t.ghostClass||"sortable-ghost",this.dragClass=t.dragClass||"sortable-drag",this.dragging=null,this.ghost=null,this.startIndex=-1,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(e){this._unbindEvents()}_bindEvents(){this._onMouseDown=this._handleMouseDown.bind(this),this._onMouseMove=this._handleMouseMove.bind(this),this._onMouseUp=this._handleMouseUp.bind(this),this.el.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._onTouchStart=this._handleTouchStart.bind(this),this._onTouchMove=this._handleTouchMove.bind(this),this._onTouchEnd=this._handleTouchEnd.bind(this),this.el.addEventListener("touchstart",this._onTouchStart,{passive:!1}),document.addEventListener("touchmove",this._onTouchMove,{passive:!1}),document.addEventListener("touchend",this._onTouchEnd)}_unbindEvents(){this.el.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this.el.removeEventListener("touchstart",this._onTouchStart),document.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("touchend",this._onTouchEnd)}_handleMouseDown(e){var s;let t=this._findItem(e.target);t&&(this.handle&&(typeof((s=e.target)==null?void 0:s.closest)!="function"||!e.target.closest(this.handle))||(e.preventDefault(),this._startDrag(t,e.clientX,e.clientY)))}_handleTouchStart(e){var n;let t=this._findItem(e.target);if(!t||this.handle&&(typeof((n=e.target)==null?void 0:n.closest)!="function"||!e.target.closest(this.handle)))return;e.preventDefault();let s=e.touches[0];this._startDrag(t,s.clientX,s.clientY)}_findItem(e){let t=e;for(;t&&t.parentElement!==this.el;)t=t.parentElement;return t}_startDrag(e,t,s){this.dragging=e,this.activeContainer=e.parentElement,this.initialContainer=this.activeContainer,this.startIndex=Array.from(this.activeContainer.children).indexOf(e),this.startY=s,this.startX=t,this.itemHeight=e.offsetHeight;let n=e.getBoundingClientRect();this.ghostStartTop=n.top,this.ghostStartLeft=n.left,this.ghost=e.cloneNode(!0),this.ghost.classList.add(this.ghostClass),this.ghost.style.position="fixed",this.ghost.style.zIndex="9999",this.ghost.style.width=`${e.offsetWidth}px`,this.ghost.style.height=`${e.offsetHeight}px`,this.ghost.style.left=`${this.ghostStartLeft}px`,this.ghost.style.top=`${this.ghostStartTop}px`,this.ghost.style.pointerEvents="none",this.ghost.style.opacity="0.8",this.ghost.style.transition="none",document.body.appendChild(this.ghost),e.classList.add(this.dragClass),e.style.opacity="0.4"}_handleMouseMove(e){this.dragging&&(e.preventDefault(),this._updateDrag(e.clientX,e.clientY))}_handleTouchMove(e){if(!this.dragging)return;e.preventDefault();let t=e.touches[0];this._updateDrag(t.clientX,t.clientY)}_updateDrag(e,t){let s=t-this.startY,n=e-this.startX;this.ghost&&(this.ghost.style.top=`${this.ghostStartTop+s}px`,this.ghost.style.left=`${this.ghostStartLeft+n}px`),this.ghost.style.display="none";let i=document.elementFromPoint(e,t);if(this.ghost.style.display="",i){let h=i.closest('[data-hook="Sortable"]');if(h&&h!==this.activeContainer&&h.dataset.hookConfig)try{JSON.parse(h.dataset.hookConfig).group===this.config.group&&(this.activeContainer=h,this.activeContainer.appendChild(this.dragging))}catch(d){}}let o=Array.from(this.activeContainer.children),r=o.indexOf(this.dragging);for(let h=0;h<o.length;h++){if(h===r)continue;let d=o[h],u=d.getBoundingClientRect(),g=u.top+u.height/2;if(t<g&&h<r){this.activeContainer.insertBefore(this.dragging,d);break}else if(t>g&&h>r){this.activeContainer.insertBefore(this.dragging,d.nextSibling);break}}}_handleMouseUp(e){this.dragging&&this._endDrag()}_handleTouchEnd(e){this.dragging&&this._endDrag()}_endDrag(){let e=Array.from(this.activeContainer.children).indexOf(this.dragging),t=this.dragging.dataset.id||this.dragging.dataset.itemId||this.dragging.dataset.hid,s=this.initialContainer.dataset.id||this.initialContainer.dataset.listId||this.initialContainer.dataset.containerId||this.initialContainer.dataset.hid,n=this.activeContainer.dataset.id||this.activeContainer.dataset.listId||this.activeContainer.dataset.containerId||this.activeContainer.dataset.hid,i=this.initialContainer,o=this.startIndex,r=this.dragging;if(this.dragging.classList.remove(this.dragClass),this.dragging.style.opacity="",this.ghost&&this.ghost.remove(),this.activeContainer!==this.initialContainer||e!==this.startIndex){let h=()=>{if(!i||!r)return;let u=Array.from(i.children)[o]||null;i.insertBefore(r,u)};this.pushEvent("reorder",{id:t,itemId:t,fromContainerId:s,toContainerId:n,fromIndex:this.startIndex,toIndex:e},h)}this.dragging=null,this.ghost=null,this.activeContainer=null,this.initialContainer=null}};var A=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.axis=t.axis||"both",this.handle=t.handle||null,this.bounds=t.bounds||null,this.dragging=!1,this.startX=0,this.startY=0,this.currentX=0,this.currentY=0,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s,this.axis=t.axis||"both",this.bounds=t.bounds||null}destroyed(e){this._unbindEvents()}_bindEvents(){this._onMouseDown=this._handleMouseDown.bind(this),this._onMouseMove=this._handleMouseMove.bind(this),this._onMouseUp=this._handleMouseUp.bind(this);let e=this.handle?this.el.querySelector(this.handle):this.el;e&&e.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._onTouchStart=this._handleTouchStart.bind(this),this._onTouchMove=this._handleTouchMove.bind(this),this._onTouchEnd=this._handleTouchEnd.bind(this),e&&e.addEventListener("touchstart",this._onTouchStart,{passive:!1}),document.addEventListener("touchmove",this._onTouchMove,{passive:!1}),document.addEventListener("touchend",this._onTouchEnd)}_unbindEvents(){let e=this.handle?this.el.querySelector(this.handle):this.el;e&&(e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("touchstart",this._onTouchStart)),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("touchend",this._onTouchEnd)}_handleMouseDown(e){e.preventDefault(),this._startDrag(e.clientX,e.clientY)}_handleTouchStart(e){e.preventDefault();let t=e.touches[0];this._startDrag(t.clientX,t.clientY)}_startDrag(e,t){this.dragging=!0,this.startX=e-this.currentX,this.startY=t-this.currentY,this.el.classList.add("dragging")}_handleMouseMove(e){this.dragging&&(e.preventDefault(),this._updatePosition(e.clientX,e.clientY))}_handleTouchMove(e){if(!this.dragging)return;e.preventDefault();let t=e.touches[0];this._updatePosition(t.clientX,t.clientY)}_updatePosition(e,t){let s=e-this.startX,n=t-this.startY;if(this.axis==="x"?n=this.currentY:this.axis==="y"&&(s=this.currentX),this.bounds){let i=this._getBounds();s=Math.max(i.minX,Math.min(i.maxX,s)),n=Math.max(i.minY,Math.min(i.maxY,n))}this.currentX=s,this.currentY=n,this.el.style.transform=`translate(${s}px, ${n}px)`}_getBounds(){let e=this.el.getBoundingClientRect(),t;return this.bounds==="parent"?t=this.el.parentElement.getBoundingClientRect():t={left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},{minX:t.left-e.left+this.currentX,maxX:t.right-e.right+this.currentX,minY:t.top-e.top+this.currentY,maxY:t.bottom-e.bottom+this.currentY}}_handleMouseUp(e){this.dragging&&this._endDrag()}_handleTouchEnd(e){this.dragging&&this._endDrag()}_endDrag(){this.dragging=!1,this.el.classList.remove("dragging"),this.pushEvent("position",{x:this.currentX,y:this.currentY})}};var N=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.hoverClass=t.hoverClass||"drag-over",this._bind()}updated(e,t,s){this.config=t,this.pushEvent=s,this.hoverClass=t.hoverClass||"drag-over"}destroyed(){this._unbind()}_bind(){this._enter=e=>{e.preventDefault(),this.el.classList.add(this.hoverClass)},this._over=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},this._leave=e=>{this.el.contains(e.relatedTarget)||this.el.classList.remove(this.hoverClass)},this._drop=e=>{var i,o;e.preventDefault(),this.el.classList.remove(this.hoverClass);let t={x:e.clientX,y:e.clientY};if(window.__vango_dragging__){let r=window.__vango_dragging__;t.id=r.dataset.id||r.dataset.hid,window.__vango_dragging__=null}let s=(i=e.dataTransfer)==null?void 0:i.files;s!=null&&s.length&&(t.fileNames=Array.from(s).map(r=>r.name));let n=(o=e.dataTransfer)==null?void 0:o.getData("text/plain");n&&(t.text=n),this.pushEvent("drop",t)},this.el.addEventListener("dragenter",this._enter),this.el.addEventListener("dragover",this._over),this.el.addEventListener("dragleave",this._leave),this.el.addEventListener("drop",this._drop)}_unbind(){this.el.removeEventListener("dragenter",this._enter),this.el.removeEventListener("dragover",this._over),this.el.removeEventListener("dragleave",this._leave),this.el.removeEventListener("drop",this._drop)}};var O=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.handles=(t.handles||"se").split(",").map(n=>n.trim()),this.resizing=!1,this._handleEls=[],this._createHandles(),this._bind()}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(){this._unbind(),this._handleEls.forEach(e=>e.remove())}_createHandles(){getComputedStyle(this.el).position==="static"&&(this.el.style.position="relative");let e={n:"n",s:"s",e:"e",w:"w",ne:"ne",se:"se",sw:"sw",nw:"nw"};for(let t of this.handles){if(!e[t])continue;let s=document.createElement("div");s.dataset.handle=t,s.style.cssText=`position:absolute;z-index:10;cursor:${t}-resize;`+this._pos(t),this.el.appendChild(s),this._handleEls.push(s)}}_pos(e){return{n:"top:-4px;left:25%;width:50%;height:8px",s:"bottom:-4px;left:25%;width:50%;height:8px",e:"right:-4px;top:25%;width:8px;height:50%",w:"left:-4px;top:25%;width:8px;height:50%",ne:"top:-4px;right:-4px;width:8px;height:8px",se:"bottom:-4px;right:-4px;width:8px;height:8px",sw:"bottom:-4px;left:-4px;width:8px;height:8px",nw:"top:-4px;left:-4px;width:8px;height:8px"}[e]||""}_bind(){this._onDown=e=>{e.preventDefault(),this._start(e.target.dataset.handle,e.clientX,e.clientY)},this._onMove=e=>{this.resizing&&(e.preventDefault(),this._update(e.clientX,e.clientY))},this._onUp=()=>{this.resizing&&this._end()},this._handleEls.forEach(e=>e.addEventListener("mousedown",this._onDown)),document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onUp)}_unbind(){this._handleEls.forEach(e=>e.removeEventListener("mousedown",this._onDown)),document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onUp)}_start(e,t,s){this.resizing=!0,this._h=e,this._sx=t,this._sy=s;let n=this.el.getBoundingClientRect();this._sw=n.width,this._sh=n.height}_update(e,t){let s=e-this._sx,n=t-this._sy,i=this._sw,o=this._sh;this._h.includes("e")&&(i=this._sw+s),this._h.includes("w")&&(i=this._sw-s),this._h.includes("s")&&(o=this._sh+n),this._h.includes("n")&&(o=this._sh-n);let r=this.config;i=Math.max(r.minWidth||0,Math.min(r.maxWidth||1/0,i)),o=Math.max(r.minHeight||0,Math.min(r.maxHeight||1/0,o)),this.el.style.width=i+"px",this.el.style.height=o+"px"}_end(){this.resizing=!1;let e=this.el.getBoundingClientRect();this.pushEvent("resize",{width:Math.round(e.width),height:Math.round(e.height)})}};var M=class{mounted(e,t,s){this.el=e,this.config=t,this.tooltip=null,this.content=t.content||"",this.placement=t.placement||"top",this.delay=t.delay||200,this._bindEvents()}updated(e,t,s){this.content=t.content||"",this.placement=t.placement||"top",this.tooltip&&(this.tooltip.textContent=this.content)}destroyed(e){this._unbindEvents(),this._hideTooltip()}_bindEvents(){this._onMouseEnter=this._handleMouseEnter.bind(this),this._onMouseLeave=this._handleMouseLeave.bind(this),this.el.addEventListener("mouseenter",this._onMouseEnter),this.el.addEventListener("mouseleave",this._onMouseLeave)}_unbindEvents(){this.el.removeEventListener("mouseenter",this._onMouseEnter),this.el.removeEventListener("mouseleave",this._onMouseLeave)}_handleMouseEnter(){this._showTimer=setTimeout(()=>{this._showTooltip()},this.delay)}_handleMouseLeave(){clearTimeout(this._showTimer),this._hideTooltip()}_showTooltip(){this.content&&(this.tooltip=document.createElement("div"),this.tooltip.className="vango-tooltip",this.tooltip.textContent=this.content,this.tooltip.style.cssText=`
            position: fixed;
            z-index: 10000;
            padding: 4px 8px;
            background: #333;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
        `,document.body.appendChild(this.tooltip),this._position())}_position(){if(!this.tooltip)return;let e=this.el.getBoundingClientRect(),t=this.tooltip.getBoundingClientRect(),s,n;switch(this.placement){case"top":s=e.top-t.height-8,n=e.left+(e.width-t.width)/2;break;case"bottom":s=e.bottom+8,n=e.left+(e.width-t.width)/2;break;case"left":s=e.top+(e.height-t.height)/2,n=e.left-t.width-8;break;case"right":s=e.top+(e.height-t.height)/2,n=e.right+8;break;default:s=e.top-t.height-8,n=e.left+(e.width-t.width)/2}this.tooltip.style.top=`${s}px`,this.tooltip.style.left=`${n}px`}_hideTooltip(){this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}};var I=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.closeOnEscape=t.closeOnEscape!==!1,this.closeOnClickOutside=t.closeOnClickOutside!==!1,this._bindEvents()}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(e){this._unbindEvents()}_bindEvents(){this._onClickOutside=this._handleClickOutside.bind(this),this._onKeyDown=this._handleKeyDown.bind(this),setTimeout(()=>{document.addEventListener("click",this._onClickOutside),document.addEventListener("keydown",this._onKeyDown)},0)}_unbindEvents(){document.removeEventListener("click",this._onClickOutside),document.removeEventListener("keydown",this._onKeyDown)}_handleClickOutside(e){this.closeOnClickOutside&&(this.el.contains(e.target)||this.pushEvent("close",{}))}_handleKeyDown(e){this.closeOnEscape&&e.key==="Escape"&&(e.preventDefault(),this.pushEvent("close",{}))}};var U=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.duration=t.duration||200,this.isOpen=!!t.open,this.animating=!1,this.isOpen||(e.style.height="0",e.style.overflow="hidden")}updated(e,t,s){this.pushEvent=s,this.duration=t.duration||200;let n=!!t.open;n!==this.isOpen&&(n?this._expand():this._collapse())}destroyed(){}_expand(){if(this.animating||this.isOpen)return;this.animating=!0,this.isOpen=!0;let e=this.el;e.style.height="auto";let t=e.scrollHeight;e.style.height="0",e.style.overflow="hidden",e.offsetHeight,e.style.transition=`height ${this.duration}ms ease`,e.style.height=t+"px",setTimeout(()=>{e.style.transition="",e.style.height="auto",e.style.overflow="",this.animating=!1,this.pushEvent("toggle",{open:!0})},this.duration)}_collapse(){if(this.animating||!this.isOpen)return;this.animating=!0,this.isOpen=!1;let e=this.el;e.style.height=e.scrollHeight+"px",e.style.overflow="hidden",e.offsetHeight,e.style.transition=`height ${this.duration}ms ease`,e.style.height="0",setTimeout(()=>{e.style.transition="",this.animating=!1,this.pushEvent("toggle",{open:!1})},this.duration)}};var F=class{mounted(e,t,s){this.el=e,this.pushEvent=s,this.active=t.active!==!1,this.restoreFocusTo=document.activeElement,this._onKeyDown=this._handleKeyDown.bind(this),this.el.addEventListener("keydown",this._onKeyDown),this.active&&this._focusFirst()}updated(e,t,s){this.active=t.active!==!1,this.pushEvent=s}destroyed(e){this.el.removeEventListener("keydown",this._onKeyDown),this.restoreFocusTo&&typeof this.restoreFocusTo.focus=="function"&&this.restoreFocusTo.focus()}_handleKeyDown(e){if(!this.active||e.key!=="Tab")return;let t=this._getFocusableElements();if(t.length===0){e.preventDefault();return}let s=t[0],n=t[t.length-1];e.shiftKey?document.activeElement===s&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),s.focus())}_focusFirst(){let e=this._getFocusableElements();e.length>0?e[0].focus():(this.el.setAttribute("tabindex","-1"),this.el.focus())}_getFocusableElements(){return this.el.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')}};var P=class{mounted(e,t,s){this.el=e,this.pushEvent=s,this.target=t.target||"body",this.placeholder=document.createComment("portal-placeholder"),e.parentNode&&e.parentNode.insertBefore(this.placeholder,e);let n=document.getElementById("vango-portal-root");n||(n=document.createElement("div"),n.id="vango-portal-root",n.style.cssText="position: relative; z-index: 9999;",document.body.appendChild(n)),n.appendChild(e)}updated(e,t,s){this.pushEvent=s}destroyed(e){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.parentNode.insertBefore(this.el,this.placeholder),this.placeholder.remove())}};function J(){if(typeof document=="undefined")return;let c=document.getElementById("vango-portal-root");return c||(c=document.createElement("div"),c.id="vango-portal-root",c.style.cssText="position: relative; z-index: 9999;",document.body.appendChild(c)),c}var V=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.previousFocus=document.activeElement,this._onKeyDown=this._handleKeyDown.bind(this),this._onClick=this._handleClick.bind(this),document.addEventListener("keydown",this._onKeyDown),t.closeOnOutside!==!1&&setTimeout(()=>{document.addEventListener("click",this._onClick)},0),this._focusFirst(),this._originalOverflow=document.body.style.overflow,document.body.style.overflow="hidden"}updated(e,t,s){this.config=t,this.pushEvent=s}destroyed(e){document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("click",this._onClick),document.body.style.overflow=this._originalOverflow||"",this.previousFocus&&typeof this.previousFocus.focus=="function"&&this.previousFocus.focus()}_handleKeyDown(e){if(e.key==="Escape"&&this.config.closeOnEscape!==!1){e.preventDefault(),this.pushEvent("close",{});return}e.key==="Tab"&&this._trapFocus(e)}_handleClick(e){this.el.contains(e.target)||this.pushEvent("close",{})}_focusFirst(){if(this.config.initialFocus){let t=this.el.querySelector(this.config.initialFocus);if(t){t.focus();return}}let e=this._getFocusableElements();e.length>0?e[0].focus():(this.el.setAttribute("tabindex","-1"),this.el.focus())}_trapFocus(e){let t=this._getFocusableElements();if(t.length===0){e.preventDefault();return}let s=t[0],n=t[t.length-1];e.shiftKey?document.activeElement===s&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),s.focus())}_getFocusableElements(){return this.el.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')}};var H=class{mounted(e,t,s){this.el=e,this.config=t,this.pushEvent=s,this.trigger=e.querySelector("[data-popover-trigger]"),this.content=e.querySelector("[data-popover-content]"),this.content||(this.content=e),this._onKeyDown=this._handleKeyDown.bind(this),this._onClick=this._handleClick.bind(this),this._onScroll=this._handleScroll.bind(this),this._onResize=this._handleResize.bind(this),document.addEventListener("keydown",this._onKeyDown),t.closeOnOutside!==!1&&setTimeout(()=>{document.addEventListener("click",this._onClick)},0),window.addEventListener("scroll",this._onScroll,!0),window.addEventListener("resize",this._onResize),this._position()}updated(e,t,s){this.config=t,this.pushEvent=s,this._position()}destroyed(e){document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("click",this._onClick),window.removeEventListener("scroll",this._onScroll,!0),window.removeEventListener("resize",this._onResize)}_handleKeyDown(e){e.key==="Escape"&&this.config.closeOnEscape!==!1&&(e.preventDefault(),this.pushEvent("close",{}))}_handleClick(e){this.el.contains(e.target)||this.pushEvent("close",{})}_handleScroll(){this._position()}_handleResize(){this._position()}_position(){if(!this.trigger||!this.content)return;let e=this.trigger.getBoundingClientRect(),t=this.content.getBoundingClientRect(),s=this.config.offset||4,n=this.config.side||"bottom",i=this.config.align||"center",o,r;switch(n){case"top":o=e.top-t.height-s,o<0&&(o=e.bottom+s,n="bottom");break;case"bottom":o=e.bottom+s,o+t.height>window.innerHeight&&(o=e.top-t.height-s,n="top");break;case"left":r=e.left-t.width-s,r<0&&(r=e.right+s,n="right");break;case"right":r=e.right+s,r+t.width>window.innerWidth&&(r=e.left-t.width-s,n="left");break}if(n==="top"||n==="bottom"){switch(i){case"start":r=e.left;break;case"center":r=e.left+(e.width-t.width)/2;break;case"end":r=e.right-t.width;break}r<0&&(r=0),r+t.width>window.innerWidth&&(r=window.innerWidth-t.width)}if(n==="left"||n==="right"){switch(i){case"start":o=e.top;break;case"center":o=e.top+(e.height-t.height)/2;break;case"end":o=e.bottom-t.height;break}o<0&&(o=0),o+t.height>window.innerHeight&&(o=window.innerHeight-t.height)}this.content.style.position="fixed",this.content.style.top=`${o}px`,this.content.style.left=`${r}px`,this.content.dataset.side=n}};var K=class{mounted(e,t={}){let s=t&&t.storageKey?String(t.storageKey):"theme",n=()=>{let o="";try{o=localStorage.getItem(s)||""}catch(d){o=""}let r=window.matchMedia&&window.matchMedia("(prefers-color-scheme:dark)").matches,h=o==="dark"||!o&&r;document.documentElement.classList.toggle("dark",h)},i=()=>{let o=!document.documentElement.classList.contains("dark");document.documentElement.classList.toggle("dark",o);try{localStorage.setItem(s,o?"dark":"light")}catch(r){}};n(),this._onClick=o=>{o.preventDefault(),i()},e.addEventListener("click",this._onClick)}destroyed(e){this._onClick&&e.removeEventListener("click",this._onClick),this._onClick=null}};var B=class{constructor(e){this.client=e,this.instances=new Map,this.instancesByHookID=new Map,this.pendingReverts=new Map,this._hookIdCounter=0,this.hooks={Sortable:D,Draggable:A,Droppable:N,Resizable:O,Tooltip:M,Dropdown:I,Collapsible:U,FocusTrap:F,Portal:P,Dialog:V,Popover:H,ThemeToggle:K},document.addEventListener("vango:hook-revert",t=>{var n;let s=(n=t.detail)==null?void 0:n.hid;s&&this.revert(s)})}register(e,t){this.hooks[e]=t}initializeFromDOM(){document.querySelectorAll("[data-hook]").forEach(e=>{this.initializeForNode(e)})}updateFromDOM(){document.querySelectorAll("[data-hook]").forEach(e=>{let t=e.dataset.hook,s=e.dataset.hookConfig||"",n=e.dataset.hid;if(n){let h=this.instances.get(n);if(!h){this.initializeForNode(e);return}if(h.hookName!==t){this.destroyForNode(e),this.initializeForNode(e);return}if(h.hookConfigRaw!==s){let d={};try{s&&(d=JSON.parse(s))}catch(u){this.client.options.debug&&console.warn("[Vango] Invalid hook config:",u)}this.updateConfig(n,d),h.hookConfigRaw=s}return}let o=e.dataset.vangoHookId||"",r=o?this.instancesByHookID.get(o):null;if(!r){this.initializeForNode(e);return}if(r.hookName!==t){this.destroyForNode(e),this.initializeForNode(e);return}if(r.hookConfigRaw!==s){let h={};try{s&&(h=JSON.parse(s))}catch(d){this.client.options.debug&&console.warn("[Vango] Invalid hook config:",d)}if(r.instance.updated){let d=(u,g={},v=null)=>{typeof v=="function"&&this.pendingReverts.set(o,v)};r.instance.updated(r.el,h,d)}r.hookConfigRaw=s}})}initializeForNode(e){let t=e.dataset.hook;if(!t)return;let s=this.hooks[t];if(!s){this.client.options.debug&&console.warn("[Vango] Unknown hook:",t);return}let n=e.dataset.hid,i="hid",o=n;if(o){if(this.instances.has(o))return}else if(i="hookID",o=e.dataset.vangoHookId,o||(this._hookIdCounter++,o=`hk${this._hookIdCounter}`,e.dataset.vangoHookId=o),this.instancesByHookID.has(o))return;let r={},h=e.dataset.hookConfig||"";try{h&&(r=JSON.parse(h))}catch(g){this.client.options.debug&&console.warn("[Vango] Invalid hook config:",g)}let d=(g,v={},y=null)=>{if(i!=="hid"){this.client.options.debug&&console.warn("[Vango] Hook event ignored: hook element has no data-hid");return}typeof y=="function"&&this.pendingReverts.set(o,y),this.client.sendHookEvent(o,g,v)},u=new s;u.mounted(e,r,d),i==="hid"?this.instances.set(o,{hook:s,hookName:t,hookConfigRaw:h,instance:u,el:e}):this.instancesByHookID.set(o,{hook:s,hookName:t,hookConfigRaw:h,instance:u,el:e})}destroyForNode(e){var i,o;let t=(i=e.dataset)==null?void 0:i.hid;if(t){let r=this.instances.get(t);r&&(r.instance.destroyed&&r.instance.destroyed(r.el),this.instances.delete(t));return}let s=(o=e.dataset)==null?void 0:o.vangoHookId;if(!s)return;let n=this.instancesByHookID.get(s);n&&(n.instance.destroyed&&n.instance.destroyed(n.el),this.instancesByHookID.delete(s))}destroyAll(){for(let[e,t]of this.instances)t.instance.destroyed&&t.instance.destroyed(t.el);this.instances.clear();for(let[e,t]of this.instancesByHookID)t.instance.destroyed&&t.instance.destroyed(t.el);this.instancesByHookID.clear()}updateConfig(e,t){let s=this.instances.get(e);if(s&&s.instance.updated){let n=(i,o={},r=null)=>{typeof r=="function"&&this.pendingReverts.set(e,r),this.client.sendHookEvent(e,i,o)};s.instance.updated(s.el,t,n)}}revert(e){if(!e||!this.pendingReverts.has(e))return;let t=this.pendingReverts.get(e);typeof t=="function"&&t(),this.pendingReverts.delete(e)}};var p={CONNECTING:"connecting",CONNECTED:"connected",RECONNECTING:"reconnecting",DISCONNECTED:"disconnected"},Q={[p.CONNECTING]:"vango-connecting",[p.CONNECTED]:"vango-connected",[p.RECONNECTING]:"vango-reconnecting",[p.DISCONNECTED]:"vango-disconnected"},E=class{constructor(e={}){this.options={toastOnReconnect:e.toastOnReconnect||!1,toastMessage:e.toastMessage||"Connection restored",toastDuration:e.toastDuration||3e3,maxRetries:e.maxRetries||10,baseDelay:e.baseDelay||1e3,maxDelay:e.maxDelay||3e4,debug:e.debug||!1,...e},this.state=p.CONNECTING,this.retryCount=0,this.previousState=null,this._updateClasses()}setState(e){this.state!==e&&(this.previousState=this.state,this.state=e,this._updateClasses(),this._dispatchEvent(e,this.previousState),this.options.toastOnReconnect&&e===p.CONNECTED&&this.previousState!==p.CONNECTED&&this.showToast(this.options.toastMessage),this.options.debug&&console.log(`[Vango] Connection state: ${this.previousState} -> ${e}`))}_updateClasses(){let e=document.documentElement;Object.values(Q).forEach(s=>{e.classList.remove(s)});let t=Q[this.state];t&&e.classList.add(t)}_dispatchEvent(e,t){let s=new CustomEvent("vango:connection",{detail:{state:e,previousState:t},bubbles:!0});document.dispatchEvent(s)}onConnect(){this.retryCount=0,this.setState(p.CONNECTED)}onDisconnect(){this.state===p.CONNECTED&&this.setState(p.RECONNECTING)}onReconnectFailed(){return this.retryCount++,this.retryCount>=this.options.maxRetries?(this.setState(p.DISCONNECTED),!1):!0}getNextRetryDelay(){return Math.min(this.options.baseDelay*Math.pow(2,this.retryCount),this.options.maxDelay)}getState(){return this.state}isConnected(){return this.state===p.CONNECTED}isDisconnected(){return this.state===p.DISCONNECTED}reset(){this.retryCount=0,this.setState(p.CONNECTED)}showToast(e,t=this.options.toastDuration){if(typeof window.__VANGO_TOAST__=="function"){window.__VANGO_TOAST__(e,t);return}let s=document.createElement("div");s.className="vango-toast",s.textContent=e,s.setAttribute("role","alert"),s.setAttribute("aria-live","polite"),Object.assign(s.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",backgroundColor:"hsl(var(--primary, 220 13% 18%))",color:"hsl(var(--primary-foreground, 0 0% 100%))",borderRadius:"var(--radius, 6px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"10001",opacity:"0",transition:"opacity 0.3s ease",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px"}),document.body.appendChild(s),requestAnimationFrame(()=>{s.style.opacity="1"}),setTimeout(()=>{s.style.opacity="0",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},t)}};function Z(){if(document.getElementById("vango-connection-styles"))return;let c=document.createElement("style");c.id="vango-connection-styles",c.textContent=`
        /* Vango Connection State Styles */

        /* Connecting indicator - pulsing bar at top */
        html.vango-connecting::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--vango-primary, #3b82f6), transparent);
            animation: vango-connect-pulse 1.5s ease-in-out infinite;
            z-index: 9999;
        }

        @keyframes vango-connect-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Reconnecting indicator - pulsing bar at top */
        html.vango-reconnecting::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--vango-primary, #3b82f6), transparent);
            animation: vango-reconnect-pulse 1.5s ease-in-out infinite;
            z-index: 9999;
        }

        @keyframes vango-reconnect-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Disconnected state - slight grayscale and overlay */
        html.vango-disconnected {
            filter: grayscale(0.3);
        }

        html.vango-disconnected::before {
            content: 'Connection lost. Click to retry...';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: hsl(var(--background, 0 0% 100%));
            border: 1px solid hsl(var(--border, 0 0% 90%));
            padding: 16px 32px;
            border-radius: var(--radius, 6px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 14px;
            color: hsl(var(--foreground, 0 0% 9%));
            cursor: pointer;
        }

        /* Toast notifications */
        .vango-toast {
            animation: vango-toast-slide-up 0.3s ease-out;
        }

        @keyframes vango-toast-slide-up {
            from {
                transform: translateX(-50%) translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
    `,document.head.appendChild(c)}var q=class{constructor(e,t={}){this.client=e,this.options={debug:t.debug||!1,...t},this.pending=new Map}applyPatch(e){let{op:t,params:s}=e;if(!s||typeof s!="object"){this.options.debug&&console.warn("[Vango URL] Invalid params:",s);return}let n=new URL(window.location);for(let[o,r]of Object.entries(s))r===""||r===null||r===void 0?n.searchParams.delete(o):n.searchParams.set(o,r);let i=t===48;this.options.debug&&console.log("[Vango URL]",i?"Push":"Replace",n.toString()),i?history.pushState(null,"",n.toString()):history.replaceState(null,"",n.toString()),this._dispatchEvent(s,i)}_dispatchEvent(e,t){let s=new CustomEvent("vango:url",{detail:{params:e,mode:t?"push":"replace",url:window.location.href},bubbles:!0});document.dispatchEvent(s)}getParams(){let e={},t=new URLSearchParams(window.location.search);for(let[s,n]of t)e[s]=n;return e}getParam(e){return new URLSearchParams(window.location.search).get(e)}hasParam(e){return new URLSearchParams(window.location.search).has(e)}};var w={DB_WINS:0,LOCAL_WINS:1,PROMPT:2,LWW:3},$=class{constructor(e,t={}){this.client=e,this.options={channelName:"vango:prefs",storagePrefix:"vango_pref_",debug:t.debug||!1,...t},this.prefs=new Map,this.channel=null,typeof BroadcastChannel!="undefined"&&(this.channel=new BroadcastChannel(this.options.channelName),this.channel.onmessage=s=>this._handleBroadcast(s)),typeof window!="undefined"&&window.addEventListener("storage",s=>this._handleStorageEvent(s))}register(e,t,s={}){let n=new j(this,e,t,s);return this.prefs.set(e,n),n._loadFromStorage(),n}get(e){return this.prefs.get(e)}broadcast(e,t,s){this.channel&&this.channel.postMessage({type:"update",key:e,value:t,updatedAt:s.toISOString()})}_handleBroadcast(e){let{type:t,key:s,value:n,updatedAt:i}=e.data;if(t==="update"){let o=this.prefs.get(s);o&&o._setFromRemote(n,new Date(i))}this.options.debug&&console.log("[Vango Prefs] Broadcast received:",e.data)}_handleStorageEvent(e){if(!e.key||!e.key.startsWith(this.options.storagePrefix))return;let t=e.key.slice(this.options.storagePrefix.length),s=this.prefs.get(t);if(s&&e.newValue)try{let n=JSON.parse(e.newValue);s._setFromRemote(n.value,new Date(n.updatedAt))}catch(n){this.options.debug&&console.warn("[Vango Prefs] Failed to parse storage event:",n)}}saveToStorage(e,t,s){if(typeof localStorage=="undefined")return;let n=this.options.storagePrefix+e,i={value:t,updatedAt:s.toISOString()};try{localStorage.setItem(n,JSON.stringify(i))}catch(o){this.options.debug&&console.warn("[Vango Prefs] Failed to save to storage:",o)}}loadFromStorage(e){if(typeof localStorage=="undefined")return null;let t=this.options.storagePrefix+e;try{let s=localStorage.getItem(t);if(s){let n=JSON.parse(s);return{value:n.value,updatedAt:new Date(n.updatedAt)}}}catch(s){this.options.debug&&console.warn("[Vango Prefs] Failed to load from storage:",s)}return null}removeFromStorage(e){if(typeof localStorage=="undefined")return;let t=this.options.storagePrefix+e;try{localStorage.removeItem(t)}catch(s){}}async syncWithServer(e){for(let[t,s]of Object.entries(e)){let n=this.prefs.get(t);n&&n._mergeWithServer(s.value,new Date(s.updatedAt))}}getAllForSync(){let e={};for(let[t,s]of this.prefs)s.options.syncToServer!==!1&&(e[t]={value:s.value,updatedAt:s.updatedAt.toISOString()});return e}destroy(){this.channel&&(this.channel.close(),this.channel=null)}},j=class{constructor(e,t,s,n={}){this.manager=e,this.key=t,this.defaultValue=s,this.value=s,this.updatedAt=new Date,this.options={mergeStrategy:w.LWW,persistLocal:!0,syncToServer:!0,onConflict:null,onChange:null,...n},this.subscribers=new Set}get(){return this.value}set(e){if(this._isEqual(this.value,e))return;let t=this.value;this.value=e,this.updatedAt=new Date,this.options.persistLocal&&this.manager.saveToStorage(this.key,e,this.updatedAt),this.manager.broadcast(this.key,e,this.updatedAt),this.options.syncToServer&&this.manager.client&&this._syncToServer(),this._notifySubscribers(e,t),this.options.onChange&&this.options.onChange(e,t)}reset(){this.set(this.defaultValue)}subscribe(e){return this.subscribers.add(e),()=>this.subscribers.delete(e)}_loadFromStorage(){let e=this.manager.loadFromStorage(this.key);e&&(this.value=e.value,this.updatedAt=e.updatedAt)}_setFromRemote(e,t){let s=this._resolveConflict(this.value,e,this.updatedAt,t);if(!this._isEqual(this.value,s)){let n=this.value;this.value=s,t>this.updatedAt&&(this.updatedAt=t),this.options.persistLocal&&this.manager.saveToStorage(this.key,this.value,this.updatedAt),this._notifySubscribers(this.value,n),this.options.onChange&&this.options.onChange(this.value,n)}}_mergeWithServer(e,t){let s=this._resolveConflict(this.value,e,this.updatedAt,t);if(!this._isEqual(this.value,s)){let n=this.value;this.value=s,t>this.updatedAt&&(this.updatedAt=t),this.options.persistLocal&&this.manager.saveToStorage(this.key,this.value,this.updatedAt),this._notifySubscribers(this.value,n),this.options.onChange&&this.options.onChange(this.value,n)}}_resolveConflict(e,t,s,n){if(this.options.onConflict)return this.options.onConflict(e,t,s,n);switch(this.options.mergeStrategy){case w.DB_WINS:return t;case w.LOCAL_WINS:return e;case w.LWW:return n>s?t:e;case w.PROMPT:return n>s?t:e;default:return e}}_syncToServer(){!this.manager.client||!this.manager.client.connected||this.manager.client.sendEvent(16,"",{key:this.key,value:this.value,updatedAt:this.updatedAt.toISOString()})}_notifySubscribers(e,t){for(let s of this.subscribers)try{s(e,t)}catch(n){console.error("[Vango Prefs] Subscriber error:",n)}}_isEqual(e,t){return e===t?!0:typeof e!=typeof t?!1:typeof e=="object"&&e!==null&&t!==null?JSON.stringify(e)===JSON.stringify(t):!1}};var b={HANDSHAKE:0,EVENT:1,PATCHES:2,CONTROL:3,ACK:4,ERROR:5},Y={PING:1,PONG:2,RESYNC_REQUEST:16,RESYNC_PATCHES:17,RESYNC_FULL:18,HOOK_REVERT:48,CLOSE:32},x=class{constructor(e={}){this.options={wsUrl:e.wsUrl||this._defaultWsUrl(),reconnect:e.reconnect!==!1,reconnectInterval:e.reconnectInterval||1e3,reconnectMaxInterval:e.reconnectMaxInterval||3e4,heartbeatInterval:e.heartbeatInterval||3e4,debug:e.debug||!1,...e},this.codec=new k,this.nodeMap=new Map,this.connected=!1,this.seq=0,this.patchSeq=0,this.expectedPatchSeq=1,this.pendingResync=!1,this.wsManager=new C(this,this.options),this.patchApplier=new R(this),this.eventCapture=new T(this),this.optimistic=new L(this),this.hooks=new B(this),this.connection=new E({toastOnReconnect:e.toastOnReconnect||window.__VANGO_TOAST_ON_RECONNECT__,toastMessage:e.toastMessage||"Connection restored",maxRetries:e.maxRetries||10,baseDelay:e.reconnectInterval||1e3,maxDelay:e.reconnectMaxInterval||3e4,debug:e.debug}),this.urlManager=new q(this,{debug:e.debug}),this.prefs=new $(this,{debug:e.debug}),this.onConnect=e.onConnect||(()=>{}),this.onDisconnect=e.onDisconnect||(()=>{}),this.onError=e.onError||(t=>console.error("[Vango]",t)),J(),Z(),this._buildNodeMap(),this.wsManager.connect(this.options.wsUrl),this.eventCapture.attach(),this.hooks.initializeFromDOM()}_buildNodeMap(){document.querySelectorAll("[data-hid]").forEach(e=>{let t=e.dataset.hid;this.nodeMap.set(t,e)}),this.options.debug&&console.log(`[Vango] Mapped ${this.nodeMap.size} nodes`)}_defaultWsUrl(){let e=location.protocol==="https:"?"wss:":"ws:",t=encodeURIComponent(location.pathname+location.search);return`${e}//${location.host}/_vango/live?path=${t}`}_onConnected(){this.connected=!0,this.connection.onConnect(),this.onConnect()}_onDisconnected(){this.connected=!1,this.connection.onDisconnect(),this.onDisconnect()}_onError(e){this.onError(e)}_handleBinaryMessage(e){if(e.length<4)return;let t=e[0],s=e[2]<<8|e[3],n=e.slice(4,4+s);switch(t){case b.PATCHES:this._handlePatches(n);break;case b.CONTROL:this._handleControl(n);break;case b.ERROR:this._handleServerError(n);break;default:this.options.debug&&console.warn("[Vango] Unknown frame type:",t)}}_handlePatches(e){this.options.debug&&console.log("[Vango] Received patches buffer, length:",e.length);let{seq:t,patches:s}=this.codec.decodePatches(e);if(this.options.debug&&console.log("[Vango] Decoded",s.length,"patches, seq:",t),t<this.expectedPatchSeq){this.options.debug&&console.log("[Vango] Ignoring duplicate patch seq:",t,"expected:",this.expectedPatchSeq);return}if(t>this.expectedPatchSeq){console.warn("[Vango] Patch sequence gap detected","expected:",this.expectedPatchSeq,"received:",t),this._requestResync(this.patchSeq);return}if(this.options.debug){for(let n of s)console.log("[Vango] Patch:",n);console.log("[Vango] Applying",s.length,"patches (seq:",t,")")}this.optimistic.clearPending(),this.patchApplier.apply(s),this.hooks.updateFromDOM(),this.patchSeq=t,this.expectedPatchSeq=t+1,this.pendingResync=!1,this.wsManager.updateLastSeq(this.patchSeq),this._sendAck(t)}_handleControl(e){if(e.length===0)return;let t=e[0];switch(t){case Y.PONG:this.options.debug&&console.log("[Vango] Pong received");break;case Y.RESYNC_FULL:this._handleResyncFull(e.slice(1));break;case Y.HOOK_REVERT:{let{value:s}=this.codec.decodeString(e,1);this.hooks.revert(s);break}case Y.CLOSE:this.wsManager.close();break;default:this.options.debug&&console.log("[Vango] Unknown control type:",t)}}_handleResyncFull(e){if(e.length===0)return;let{value:t}=this.codec.decodeString(e,0);this.options.debug&&console.log("[Vango] ResyncFull received, replacing body content");let s=document.createElement("template");for(s.innerHTML=t,this.nodeMap.clear(),this.hooks.destroyAll(),document.body.innerHTML="";s.content.firstChild;)document.body.appendChild(s.content.firstChild);this._buildNodeMap(),this.hooks.initializeFromDOM(),this.patchSeq=0,this.expectedPatchSeq=1,this.pendingResync=!1,this.wsManager.updateLastSeq(0)}_sendAck(e){if(!this.connected)return;let t=this.codec.encodeAck(e,100),s=this._encodeFrame(b.ACK,t);this.wsManager.send(s),this.options.debug&&console.log("[Vango] Sent ACK for seq:",e)}_requestResync(e){if(this.pendingResync){this.options.debug&&console.log("[Vango] Resync already pending, skipping");return}this.pendingResync=!0,this.options.debug&&console.log("[Vango] Requesting resync from seq:",e);let t=this.codec.encodeResyncRequest(e),s=this._encodeFrame(b.CONTROL,t);this.wsManager.send(s)}_handleServerError(e){if(e.length<3)return;let t=e[0]<<8|e[1],{value:s,bytesRead:n}=this.codec.decodeString(e,2),i=2+n,o=i<e.length?e[i]===1:!1,h={0:"Unknown error",1:"Invalid frame",2:"Invalid event",3:"Handler not found",4:"Handler panic",5:"Session expired",6:"Rate limited",256:"Server error",257:"Not authorized",258:"Not found",259:"Validation failed",260:"Route error"}[t]||s||`Unknown error: ${t}`,d=new Error(h);d.code=t,d.fatal=o,this.onError(d),this.optimistic.revertAll(),o&&this.wsManager.close()}sendEvent(e,t,s=null){this.connected||this.options.debug&&console.log("[Vango] Not connected, queueing event"),this.seq++;let n=this.codec.encodeEvent(this.seq,e,t,s),i=this._encodeFrame(b.EVENT,n);this.wsManager.send(i),this.options.debug&&console.log("[Vango] Sent event:",{type:e,hid:t,data:s,seq:this.seq})}_encodeFrame(e,t){let s=t.length,n=new Uint8Array(4+s);return n[0]=e,n[1]=0,n[2]=s>>8&255,n[3]=s&255,n.set(t,4),n}sendHookEvent(e,t,s={}){this.sendEvent(l.HOOK,e,{name:t,data:s})}getNode(e){return this.nodeMap.get(e)}registerNode(e,t){this.nodeMap.set(e,t)}unregisterNode(e){this.nodeMap.delete(e)}registerHook(e,t){this.hooks.register(e,t)}registerPref(e,t,s={}){return this.prefs.register(e,t,s)}destroy(){this.eventCapture.detach(),this.hooks.destroyAll(),this.prefs.destroy(),this.wsManager.close()}};function ee(){if(window.__vango__)return;let c=document.currentScript||document.querySelector("script[data-vango]"),e={};c&&(c.dataset.wsUrl&&(e.wsUrl=c.dataset.wsUrl),c.dataset.debug&&(e.debug=c.dataset.debug==="true")),window.__vango__=new x(e)}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ee):ee());var ce=x;return ae(le);})();
